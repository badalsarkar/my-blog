<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5ba1e81b32f1999dca87.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{line-height:var(--lineHeight-normal);font-size:var(--fontSize-root);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:var(--font-body);font-size:var(--fontSize-1);color:var(--color-text)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);height:1px;border:0}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);margin-top:var(--spacing-12);margin-bottom:var(--spacing-6);line-height:var(--lineHeight-tight);letter-spacing:-.025em}h2,h3,h4,h5,h6{font-weight:var(--fontWeight-bold);color:var(--color-heading)}h1{font-weight:var(--fontWeight-black);font-size:var(--fontSize-6);color:var(--color-heading-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{line-height:var(--lineHeight-relaxed);--baseline-multiplier:0.179;--x-height-multiplier:0.35;margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{margin-left:var(--spacing-0);margin-right:var(--spacing-0);margin-bottom:var(--spacing-8);list-style-position:outside;list-style-image:none}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{color:var(--color-text-light);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6);border-left:var(--spacing-1) solid var(--color-primary);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{width:100%;margin-bottom:var(--spacing-8);border-collapse:collapse;border-spacing:.25rem}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{font-size:var(--fontSize-4);color:var(--color-primary);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-weight:var(--fontWeight-bold);font-family:var(--font-heading);text-decoration:none;font-size:var(--fontSize-2)}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio-avatar,.bio p{margin-bottom:var(--spacing-0)}.bio-avatar{margin-right:var(--spacing-4);min-width:50px;border-radius:100%}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-size:var(--fontSize-2);font-family:var(--font-heading)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4);margin-left:var(--spacing-0)}ol,ul{list-style-position:inside}}.big-image{height:70vh;width:100vw;position:relative;background-size:cover;background-position:40% 40%;background-image:url(/static/hero-photo-1170c3f074d5ffc80433a57c6b9fa6e3.jpg)}.overlay{position:absolute;height:100%;width:100%;top:0;left:0;background:rgba(0,0,0,.5);color:#fff;display:flex;align-items:center;justify-content:center;flex-direction:column}.aboutContainer{display:flex;max-width:980px;margin:auto}.about-side-nav{margin-top:90px}.about-side-nav,.about-side-nav div{display:flex;flex-direction:column;align-items:center}.about-side-nav div{padding-top:20px}.about-side-nav div a{padding:5px;text-decoration:none;border:1px solid #000;border-radius:25px;font-size:.86em;margin:3px}#aboutme{margin-left:20px;padding-left:10px}#about-button{text-decoration:none;margin-left:80%;position:relative;bottom:30%;border:1px solid #efeceb;color:#efeceb;border-radius:50px;padding:10px;font-size:.86em}#about-button:hover{background:#828a63;border:1px solid #828a63;color:#fff}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.myworks-module--container--2Olx6{max-width:980px;margin:auto}.workCard-module--card--2Y22_{box-shadow:0 4px 8px 0 rgba(0,0,0,.2);padding:16px;text-align:center;background-color:#f1f1f1;transition:.3s;width:30%;border-radius:5px;margin:15px}@media screen and (max-width:600px){.workCard-module--card--2Y22_{width:100%;display:block;margin-bottom:20px}}.workCard-module--card--2Y22_:hover{box-shadow:0 8px 16px 0 rgba(0,0,0,.2);cursor:pointer}.workCard-module--card--2Y22_>div{display:flex;flex-direction:row;flex-wrap:wrap;margin-top:20px;justify-content:center}.workCard-module--tag--xIkqG{border:1px solid green;border-radius:5px;margin:3px;padding:3px;font-size:.7rem}</style><meta name="generator" content="Gatsby 2.31.1"/><link id="gist-embed-b3b573358bfc66d89e1e95dbf8319c09" as="style" href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css" rel="preload"/><noscript><link href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css" rel="stylesheet"/></noscript><script>
                  var link = document.querySelector("#gist-embed-b3b573358bfc66d89e1e95dbf8319c09");
                  link.addEventListener("load", function() {
                    this.rel = "stylesheet"
                  });
                </script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=39506c0dcc2a070de3e033f1ed2e4a3e" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=39506c0dcc2a070de3e033f1ed2e4a3e"/><title data-react-helmet="true">Implementing New Feature in Paypal/Butterfly | Blog of Badal Sarkar</title><meta data-react-helmet="true" name="description" content="I have been working on Paypal/Butterfly
project for about a month. Previously I have fixed two
bugs
and this time I am implementing a new
feature. The task is…"/><meta data-react-helmet="true" property="og:title" content="Implementing New Feature in Paypal/Butterfly"/><meta data-react-helmet="true" property="og:description" content="I have been working on Paypal/Butterfly
project for about a month. Previously I have fixed two
bugs
and this time I am implementing a new
feature. The task is…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="badalsarkar86"/><meta data-react-helmet="true" name="twitter:title" content="Implementing New Feature in Paypal/Butterfly"/><meta data-react-helmet="true" name="twitter:description" content="I have been working on Paypal/Butterfly
project for about a month. Previously I have fixed two
bugs
and this time I am implementing a new
feature. The task is…"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-268f5e1953032018ad23.js"/><link as="script" rel="preload" href="/93241701166c3169d92c9fdd395837837cace836-d57e403f6b3df0c7cfb5.js"/><link as="script" rel="preload" href="/1943edf48358ec375759a10206b57d36c98a5e6d-8d80c533ddab81581c78.js"/><link as="script" rel="preload" href="/app-f5f821bb311f1100b7dc.js"/><link as="script" rel="preload" href="/framework-29ba174b433dc5858bed.js"/><link as="script" rel="preload" href="/styles-7d4153d260c0197f0043.js"/><link as="script" rel="preload" href="/webpack-runtime-bf77c3c8088178818b5c.js"/><link as="fetch" rel="preload" href="/page-data/2020/new-feature-butterfly/2020-11-21-new-feature-butterfly/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/916993862.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/">Blog of Badal Sarkar</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Implementing New Feature in Paypal/Butterfly</h1><p>November 21, 2020</p></header><section itemProp="articleBody"><p>I have been working on <a href="https://github.com/paypal/butterfly">Paypal/Butterfly</a>
project for about a month. Previously I have fixed <a href="https://github.com/pulls?q=is%3Apr+author%3Abadalsarkar+archived%3Afalse+is%3Aclosed+repo%3Apaypal%2Fbutterfly">two
bugs</a>
and this time I am implementing a <a href="https://github.com/paypal/butterfly/issues/314">new
feature</a>. The task is to replace
existing logging framework, <a href="http://logback.qos.ch/">Logback</a>, with
<a href="https://logging.apache.org/log4j/2.x/index.html">Log4j2</a>.</p>
<h3>Logging frameworks</h3>
<p>Logging in Java requires using a <a href="https://en.wikipedia.org/wiki/Java_logging_framework">logging
framework</a>. There are many
logging frameworks to choose from. Java provides a built in framework in
<code class="language-text">java.util.logging</code> package. There are also third party logging frameworks like
Log4j, Logback, tinylog, Apache Commons Logging, SLF4J.</p>
<p>All these frameworks except SLF4J provide fundamental logging functionality with
differences in features and performance. SLF4J is a facade for various logging
frameworks.  It provides interfaces which various frameworks implement and thus
enables end users to use desired framework during deployment time. Programming
against SLF4J interfaces also means that end users can switch to a different
logging framework without changing all the codes for logging. An example
will make it clear.</p>
<div class="gatsby-highlight" data-language="java"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloWorld</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The above code example from SLF4J website, shows that we are logging an info
“Hello World” using SLF4J API <a href="http://www.slf4j.org/apidocs/org/slf4j/LoggerFactory.html"><code class="language-text">LoggerFactory</code></a>.
Behind the scene, we can use
any of the above mentioned frameworks which provides implementation for SLF4J
interfaces. Lets say we want to use Logback. All we need to do is provide the
configuration file <code class="language-text">logback.xml</code>. Again, if we decide to switch from Logback to
Log4j2, all we need to do is replace configuration of Logback with Log4j2. Our
code above doesn’t need to change. So, using SLF4J API instead of framework
specific API provides huge flexibility.</p>
<h3>Why Butterfly wants to use Log4j2</h3>
<blockquote>
<p>Apache Log4j2 is an upgrade to Log4j that provides significant improvements
over its predecessor, Log4j 1.x, and provides many of the improvements
available in Logback while fixing some inherent problems in Logback’s
architecture.</p>
</blockquote>
<p>Log4j2 offers many improvements including better performance. Its asynchronous
logger’s performance is impressive. The following comparision, of different
logging library performance gives some idea.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB50lEQVQoz3VSCY7TQBD0/1/BBxCHRFjQci6wBIVNopBscOIjPnP4GNvx+opdTLcJQiK01HKpx1NTXd1KWZboug5VVUFVVRiGgeVyybler/m7WCz+YF2e0z/z+Ry2ZWE2m+FwOOB0OjGHIoRAFEVcCIIAcRzDcRz4vg868zwP2+0WYRgyjqKQ61RL0hS73Q75wwPOoVDBtm1mpyC157iEw7TEXhQ9DmMkieAHkiRBXddQ6GUiJcKmaTjp4Iz/rqE7wfAFVq5AVxfQVj/ZAk3TWH2WZT0htUcX2rbl1i8lkVJoaxfzbz8Y244r/dszGanklslQKpDC88XLWfMF9d7E5N2QcSwSHKWqVHp5PB7ZFoWG0Ldc/6OIsVTdtidpfIWsaGCoFiYfRvhfKDRhmioRdF2Lpu6JaQSEK7lWFPs4x/ebMcx7HePfhIlUSILINso8z3uFvAIik7L78RdZDrENsF65CJYqzJkqfY4xlUTWUsf05o7/M3Sdd1eX381mw/uo0GTKusKnVx/x6PEVvg5HGA2nuHo2wOvbCW7fvsf102u8Gd7h5YsBvnweY/DkOUKpvpT7R/6dB8YtF0XBLUZSsuO6sOT2O64Hy7Hh+B5M+bLn+TBtCxanA9M0EScpb0Uj79KGUNJgfwESfT6GXYNgCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Logging library performance comparision"
        title="Logging library performance comparision"
        src="/static/3d08e29f23e9800d8c47ea7dd033edaf/f058b/loggingLibraryPerformance.png"
        srcset="/static/3d08e29f23e9800d8c47ea7dd033edaf/c26ae/loggingLibraryPerformance.png 158w,
/static/3d08e29f23e9800d8c47ea7dd033edaf/6bdcf/loggingLibraryPerformance.png 315w,
/static/3d08e29f23e9800d8c47ea7dd033edaf/f058b/loggingLibraryPerformance.png 630w,
/static/3d08e29f23e9800d8c47ea7dd033edaf/40601/loggingLibraryPerformance.png 945w,
/static/3d08e29f23e9800d8c47ea7dd033edaf/38124/loggingLibraryPerformance.png 953w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span>
source: <a href="https://logging.apache.org/log4j/2.x/performance.html">https://logging.apache.org/log4j/2.x/performance.html</a></p>
<p>You can also read about performance <a href="https://logging.apache.org/log4j/2.x/performance.html">here</a>.
Butterfly wants to take advantage of the improved performance specially the fast
asynchronous logging.</p>
<h3>How Butterfly is using Logback</h3>
<p>Butterfly is using SLF4J API with Logback implementation. The Logback
configuration file <code class="language-text">logback.xml</code> has the following contents.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1e7eface7d5834631beca33119826ed8/afa26/logBackConfig.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABIUlEQVQoz41Si26DMAzs/3/qpiECcR6Ow+3s7tV2KrVkEQK53MMXHYplT1i3jFI6qiiyVKgOzDmjzSaGWbS/H8cBr+/n37r4Zh8dpTWU2tG6ojcjaAtg35Ny/Zb57LzoFLD0ijVvWFchU4FkHs4t1t5pLw+H/wMLwJB1GD62BWtK2HMmyx7dnS27cm0h9Qr0lKHRF5sEzAuZFgIQjPJ7ANLTWsOSecynzH4l8+aiFUl2HnY2iqEHalMIfXPP5Ms/V3MGevEE/ce39I5EH0UkPLVI9CrP5dpJujceuqStZLLRGBcdI0Zlfo3LK2HcAFZtnMWV0phsEiwpx/hoN/qpD8xeYKiUm9nCIEbIu68zZjcpV3qWyhbAjYBj2A/I2Zjc1yc45GOwyDHTAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Butterfly logback configuration file"
        title="Butterfly Logback configuration file"
        src="/static/1e7eface7d5834631beca33119826ed8/f058b/logBackConfig.png"
        srcset="/static/1e7eface7d5834631beca33119826ed8/c26ae/logBackConfig.png 158w,
/static/1e7eface7d5834631beca33119826ed8/6bdcf/logBackConfig.png 315w,
/static/1e7eface7d5834631beca33119826ed8/f058b/logBackConfig.png 630w,
/static/1e7eface7d5834631beca33119826ed8/40601/logBackConfig.png 945w,
/static/1e7eface7d5834631beca33119826ed8/afa26/logBackConfig.png 1258w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Lets see what these configurations mean.</p>
<ul>
<li>At line 4, a property named <code class="language-text">logFile</code> is defined. The value of <code class="language-text">logFile</code> is
calculated dynamically at runtime by
<code class="language-text">LogFileDefiner</code> class.</li>
<li>At line 6, a pattern for timestamp is defined.</li>
<li>Line 8 to 13 defines an <code class="language-text">Appender</code> named <code class="language-text">FILE</code> which is an instance of
<a href="http://logback.qos.ch/manual/appenders.html#FileAppender"><code class="language-text">FileAppender</code></a> class
of Logback. The task of an <code class="language-text">Appender</code> is to take a logging
event and process it. So, the <code class="language-text">FILE</code> appender in this case, processes an event
by saving it in <code class="language-text">logFile</code>(line 9) using the pattern specified in line 11.</li>
<li>Line 15 to 19 defines another <code class="language-text">Appender</code> named <code class="language-text">CONSOLE</code>, an instance of
<a href="http://logback.qos.ch/manual/appenders.html#ConsoleAppender"><code class="language-text">ConsoleAppender</code></a>
class of Logback, which processes a logging event by printing
to console using the specified pattern.</li>
<li>Line 21 to 23 defines a
<a href="http://logback.qos.ch/apidocs/ch/qos/logback/classic/Logger.html"><code class="language-text">Logger</code></a>
named <code class="language-text">com.paypal.butterfly.cli</code> with level <code class="language-text">INFO</code>. A logger is an object which
is used by the application to log an event. An event can be marked by
different levels like <code class="language-text">INFO</code>,<code class="language-text">ERROR</code>,<code class="language-text">DEBUG</code>,<code class="language-text">TRACE</code> etc. When a logger receives
an event from the application it forwards that to the appenders registered with it.
In this example, there is one registered appender- <code class="language-text">CONSOLE</code> configured in line
15-19. So, when the application passes an event to <code class="language-text">com.paypal.butterfly.cli</code>
logger, it will print it to the console.</li>
<li>Line 25 to 27 defines a <code class="language-text">root</code> logger with level <code class="language-text">ERROR</code> and it has one
registered appender- <code class="language-text">FILE</code>. So, this logger will store log events to the
<code class="language-text">logFile</code>. Notice <code class="language-text">root</code> logger has no name.</li>
</ul>
<p>In addition to the above configuration file, Butterfly has two other
configuration files- LogFileDefiner.java and LogbackLogConfigurator.java.</p>
<p><code class="language-text">LogFileDefiner</code> class provides functionality to define a log file at runtime.
This log file is the file used in logback.xml line 4. You can check the full
code
<a href="https://gist.github.com/badalsarkar/8d2dab5f4fda510d1820e046b1aaa688">here</a>.
<code class="language-text">LogFileDefiner</code> class implements <code class="language-text">PropertyDefiner</code> interface of Logback. This
interface provides an abstract function <code class="language-text">public String getPropertyValue()</code> which
loads the value of <code class="language-text">logFile</code> defined at line 4.</p>
<p>LogbackLogConfigurator.java defines several methods to change some Logback
configurations at runtime such as changing log level and changing root logger’s
appender to file. You can take a look at the code <a href="https://gist.github.com/badalsarkar/dbf8371bb4059f714175852a43305b14">here</a>.</p>
<h3>How I implemented Log4j2</h3>
<p>Log4j2 also provides <a href="https://logging.apache.org/log4j/2.x/log4j-slf4j-impl/apidocs/index.html">implementation for SLF4J API</a>.
Therefore, the work is mainly related to configuration files and test files.
I planned the work in 3 phases-</p>
<ol>
<li>Add Log4j2</li>
<li>Add tests for new implementation and modify existing tests</li>
<li>Remove Logback and related tests</li>
</ol>
<p><strong>Phase 1: Add Log4j2</strong></p>
<p>Butterfly uses <a href="">Gradle</a> as build tool. I added the following dependencies in
the <code class="language-text">build.gradle</code> file.</p>
<p><html><head></head><body><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-build-gradle" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-gradle  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tbody><tr>
        <td id="file-build-gradle-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-build-gradle-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en">dependencies</span> {</td>
      </tr>
      <tr>
        <td id="file-build-gradle-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-build-gradle-LC2" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">log4j_api</span>: <span class="pl-s"><span class="pl-pds">&quot;</span>org.apache.logging.log4j:log4j-api:2.14.0<span class="pl-pds">&quot;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-build-gradle-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-build-gradle-LC3" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">log4j_core</span>:<span class="pl-s"><span class="pl-pds">&quot;</span>org.apache.logging.log4j:log4j-core:2.14.0<span class="pl-pds">&quot;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-build-gradle-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-build-gradle-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-build-gradle-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-build-gradle-LC5" class="blob-code blob-code-inner js-file-line">  <span class="pl-c"><span class="pl-c">//</span> for using SLF4J API with Log4j2</span></td>
      </tr>
      <tr>
        <td id="file-build-gradle-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-build-gradle-LC6" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">log4j_slf4j_impl</span>: <span class="pl-s"><span class="pl-pds">&quot;</span>org.apache.logging.log4j:log4j-slf4j-impl:2.14.0<span class="pl-pds">&quot;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-build-gradle-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-build-gradle-LC7" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-build-gradle-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-build-gradle-LC8" class="blob-code blob-code-inner js-file-line">  <span class="pl-c"><span class="pl-c">//</span> for async log4j2 logging</span></td>
      </tr>
      <tr>
        <td id="file-build-gradle-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-build-gradle-LC9" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">disruptor</span>:<span class="pl-s"><span class="pl-pds">&quot;</span>com.lmax:disruptor:3.3.4<span class="pl-pds">&quot;</span></span>,</td>
      </tr>
      
      
      
      <tr>
        <td id="file-build-gradle-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-build-gradle-LC13" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/build.gradle" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-build-gradle">build.gradle</a>
        hosted with &#x2764; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>
</body></html></p>
<p>Next I added the following configuration file named <code class="language-text">log4j2.xml</code>. Note, there is
a bug at line 5. I talked about it later in the blog.</p>
<p><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-log4j2-xml" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-xml  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-log4j2-xml-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-log4j2-xml-LC1" class="blob-code blob-code-inner js-file-line">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>1.0<span class="pl-pds">&quot;</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>UTF-8<span class="pl-pds">&quot;</span></span>?&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-log4j2-xml-LC2" class="blob-code blob-code-inner js-file-line">&lt;<span class="pl-ent">configuration</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-log4j2-xml-LC3" class="blob-code blob-code-inner js-file-line">  &lt;<span class="pl-ent">Appenders</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-log4j2-xml-LC4" class="blob-code blob-code-inner js-file-line">   <span class="pl-c"><span class="pl-c">&lt;!--</span> This line failed a test case <span class="pl-c">--&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-log4j2-xml-LC5" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">Console</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>CONSOLE<span class="pl-pds">&quot;</span></span> <span class="pl-e">target</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>SYSTEM_OUT<span class="pl-pds">&quot;</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-log4j2-xml-LC6" class="blob-code blob-code-inner js-file-line">	  &lt;<span class="pl-ent">PatternLayout</span> <span class="pl-e">pattern</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>%msg%n<span class="pl-pds">&quot;</span></span> /&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-log4j2-xml-LC7" class="blob-code blob-code-inner js-file-line">    &lt;/<span class="pl-ent">Console</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-log4j2-xml-LC8" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-log4j2-xml-LC9" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">Routing</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>Routing<span class="pl-pds">&quot;</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-log4j2-xml-LC10" class="blob-code blob-code-inner js-file-line">      &lt;<span class="pl-ent">Routes</span> <span class="pl-e">pattern</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>$${sys:logFile}<span class="pl-pds">&quot;</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-log4j2-xml-LC11" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">Route</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-log4j2-xml-LC12" class="blob-code blob-code-inner js-file-line">          &lt;<span class="pl-ent">RandomAccessFile</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>File<span class="pl-pds">&quot;</span></span> <span class="pl-e">fileName</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>${sys:logFile}<span class="pl-pds">&quot;</span></span> <span class="pl-e">immediateFlush</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>false<span class="pl-pds">&quot;</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-log4j2-xml-LC13" class="blob-code blob-code-inner js-file-line">            &lt;<span class="pl-ent">PatternLayout</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-log4j2-xml-LC14" class="blob-code blob-code-inner js-file-line">                &lt;<span class="pl-ent">pattern</span>&gt;[%d{HH:mm:ss.SSS}] [%-4level] %msg%n&lt;/<span class="pl-ent">pattern</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-log4j2-xml-LC15" class="blob-code blob-code-inner js-file-line">            &lt;/<span class="pl-ent">PatternLayout</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-log4j2-xml-LC16" class="blob-code blob-code-inner js-file-line">          &lt;/<span class="pl-ent">RandomAccessFile</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-log4j2-xml-LC17" class="blob-code blob-code-inner js-file-line">        &lt;/<span class="pl-ent">Route</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-log4j2-xml-LC18" class="blob-code blob-code-inner js-file-line">      &lt;/<span class="pl-ent">Routes</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-log4j2-xml-LC19" class="blob-code blob-code-inner js-file-line">    &lt;/<span class="pl-ent">Routing</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-log4j2-xml-LC20" class="blob-code blob-code-inner js-file-line">  &lt;/<span class="pl-ent">Appenders</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-log4j2-xml-LC21" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-log4j2-xml-LC22" class="blob-code blob-code-inner js-file-line">  &lt;<span class="pl-ent">Loggers</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-log4j2-xml-LC23" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">AsyncLogger</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>com.paypal.butterfly.cli<span class="pl-pds">&quot;</span></span> <span class="pl-e">level</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>INFO<span class="pl-pds">&quot;</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-log4j2-xml-LC24" class="blob-code blob-code-inner js-file-line">      &lt;<span class="pl-ent">AppenderRef</span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>CONSOLE<span class="pl-pds">&quot;</span></span> /&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-log4j2-xml-LC25" class="blob-code blob-code-inner js-file-line">    &lt;/<span class="pl-ent">AsyncLogger</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-log4j2-xml-LC26" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">AsyncRoot</span> <span class="pl-e">level</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>ERROR<span class="pl-pds">&quot;</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-log4j2-xml-LC27" class="blob-code blob-code-inner js-file-line">      &lt;<span class="pl-ent">AppenderRef</span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>Routing<span class="pl-pds">&quot;</span></span> /&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-log4j2-xml-LC28" class="blob-code blob-code-inner js-file-line">    &lt;/<span class="pl-ent">AsyncRoot</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-log4j2-xml-LC29" class="blob-code blob-code-inner js-file-line">  &lt;/<span class="pl-ent">Loggers</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-log4j2-xml-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-log4j2-xml-LC30" class="blob-code blob-code-inner js-file-line">&lt;/<span class="pl-ent">configuration</span>&gt;</td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/log4j2.xml" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2-xml">log4j2.xml</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div></p>
<p>The concept behind this configuration file is similar to the one described
above for Logback. In a nutshell, the configuration is doing the following-</p>
<ul>
<li>Define a console appender and routing appender [line 3 to 19]</li>
<li>Define two asynchronous loggers- <code class="language-text">com.paypal.butterfly.cli</code> and <code class="language-text">root</code></li>
</ul>
<p><a href="https://logging.apache.org/log4j/2.x/manual/appenders.html#RoutingAppender">Routing appender</a> at line 8
needs some explanation. The root logger at line 25 uses routing appender to store
log events to the <code class="language-text">logFile</code>. The application requirement is to set the log file
dynamically at runtime. It was easy to do so in Logback as we have seen in <code class="language-text">logback.xml</code>.
In Log4j2, I could not find a way to update the <code class="language-text">logFile</code> at runtime. So, I
wrapped the <code class="language-text">RandomAccessFile</code> (faster than <code class="language-text">File</code>) appender with <code class="language-text">Routing</code> appender.</p>
<p>This appender can have multiple routes, and a route is selected by matching the
<code class="language-text">pattern</code> attribute, in our case at line 9. A route basically determines how a log
event will be processed by using other appenders e.g. console, file etc. In our
case there is only one route which process a log event using <code class="language-text">RandomAccessFile</code>
appender. So, when the root logger passes a log event to routing appender, it
forwards the event to the RandomAccessFile appender which gets the log file name
by evaluating the expression <code class="language-text">${sys:logFile}</code> and store the log in the file. How
is this expression evaluated?</p>
<p>In Log4j2, this expression is used for property lookup. <a href="https://logging.apache.org/log4j/2.x/manual/lookups.html">There are several lookup options
to choose from</a>.  This
particular lookup is done in system property. The application will store the
name of the log file in the system property called <code class="language-text">logFile</code>. Then
<code class="language-text">RandomAccessFile</code> appender can access that system property to get the file
name.</p>
<p>Now, that Log4j2 is configured, there are two other
configuration files- <code class="language-text">LogFileDefiner.java</code> and <code class="language-text">LogbackLogConfigurator.java</code>.
I need to define new configuration to replace those files.</p>
<p><strong>LogFileDefiner</strong></p>
<p>The main function of <code class="language-text">LogFileDefiner</code> class is to expose methods to manipulate
log file name like setting log file name, getting file name etc. These are
simple getter and setter methods. In the previous section we have seen that we
need to store the log file name to system property named <code class="language-text">logFile</code>. This done by
the following function-</p>
<p><html><head></head><body><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-logfiledefiner-java" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-java  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tbody>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <tr>
        <td id="file-logfiledefiner-java-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-logfiledefiner-java-LC35" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">updateLog4jConfigWithLogFile</span>(){</td>
      </tr>
      <tr>
        <td id="file-logfiledefiner-java-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-logfiledefiner-java-LC36" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">System</span><span class="pl-k">.</span>setProperty(<span class="pl-s"><span class="pl-pds">&quot;</span>logFile<span class="pl-pds">&quot;</span></span>,<span class="pl-smi">LogFileDefiner</span><span class="pl-k">.</span>getLogFile()<span class="pl-k">.</span>getAbsolutePath());</td>
      </tr>
      <tr>
        <td id="file-logfiledefiner-java-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-logfiledefiner-java-LC37" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/LogFileDefiner.java" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-logfiledefiner-java">LogFileDefiner.java</a>
        hosted with &#x2764; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>
</body></html>
<code data-gist-id="ca176a0335131a092618cb9066fc3fee"
data-gist-file="LogFileDefiner.java" data-gist-line="35-37"></code></p>
<p>Then I am calling this function from the <code class="language-text">main</code> method. You can take a look at
the full code
<a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-logfiledefiner-java">here</a>.</p>
<p><strong>Log4j2LogConfigurator</strong></p>
<p>This class exposes methods to change some logging configurations at runtime. I
have kept the function signature same as before but changed the implementation.
To give an example, the <code class="language-text">root</code> logger uses <code class="language-text">RandomAccessFile</code> as appender. The
application has a requirement to attach <code class="language-text">ConsoleAppender</code> to root logger at
runtime. It is done by the following method-</p>
<p><html><head></head><body><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-log4j2logconfigurator-java" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-java  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tbody>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <tr>
        <td id="file-log4j2logconfigurator-java-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-log4j2logconfigurator-java-LC38" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">@Override</span></td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-log4j2logconfigurator-java-LC39" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setVerboseMode</span>(<span class="pl-k">boolean</span> <span class="pl-v">verboseMode</span>) {</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-log4j2logconfigurator-java-LC40" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">this</span><span class="pl-k">.</span>verboseMode <span class="pl-k">=</span> verboseMode;</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-log4j2logconfigurator-java-LC41" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> (verboseMode) {</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-log4j2logconfigurator-java-LC42" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">Layout</span> layout <span class="pl-k">=</span> <span class="pl-smi">PatternLayout</span><span class="pl-k">.</span>newBuilder()<span class="pl-k">.</span>withConfiguration(config)<span class="pl-k">.</span>withPattern(<span class="pl-s"><span class="pl-pds">&quot;</span>[%d{HH:mm:ss.SSS}] [%highlight(%level)] %msg%n<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>build();</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-log4j2logconfigurator-java-LC43" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">Appender</span> consoleAppender <span class="pl-k">=</span> <span class="pl-smi">ConsoleAppender</span><span class="pl-k">.</span>createDefaultAppenderForLayout(layout);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-log4j2logconfigurator-java-LC44" class="blob-code blob-code-inner js-file-line">            consoleAppender<span class="pl-k">.</span>start();</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-log4j2logconfigurator-java-LC45" class="blob-code blob-code-inner js-file-line">            config<span class="pl-k">.</span>getLoggerConfig(<span class="pl-s"><span class="pl-pds">&quot;</span>com.paypal.butterfly.cli<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>removeAppender(<span class="pl-s"><span class="pl-pds">&quot;</span>CONSOLE<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-log4j2logconfigurator-java-LC46" class="blob-code blob-code-inner js-file-line">            config<span class="pl-k">.</span>getRootLogger()<span class="pl-k">.</span>addAppender(consoleAppender,<span class="pl-c1">null</span>,<span class="pl-c1">null</span>);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-log4j2logconfigurator-java-LC47" class="blob-code blob-code-inner js-file-line">            context<span class="pl-k">.</span>updateLoggers();</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-log4j2logconfigurator-java-LC48" class="blob-code blob-code-inner js-file-line">      <span class="pl-c"><span class="pl-c">//</span>  } else {</span></td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-log4j2logconfigurator-java-LC49" class="blob-code blob-code-inner js-file-line">          <span class="pl-c"><span class="pl-c">//</span> TODO</span></td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-log4j2logconfigurator-java-LC50" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfigurator-java-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-log4j2logconfigurator-java-LC51" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      
      
      
      
      
      
      
      
      
      
      
      
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/Log4j2LogConfigurator.java" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2logconfigurator-java">Log4j2LogConfigurator.java</a>
        hosted with &#x2764; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>
</body></html></p>
<p>The above method, creates a console appender [line 42-44], removes existing
appender from root logger[line 46] and attach newly created logger [line 46-47].
To understand more about dynamic configuration change, you can read about the
architecture of Log4j2 <a href="https://logging.apache.org/log4j/2.x/manual/architecture.html">here</a>.</p>
<p>At this point, the phase 1 is complete.</p>
<p><strong>Phase 2: Add Tests</strong></p>
<p>I need to add test for <code class="language-text">Log4j2LogConfigurator</code> class. There were test cases for
the previous configuration <code class="language-text">LogbackLogConfigurator</code>. I re-implemented those
tests for Log4j2. The following test case is for the method
<code class="language-text">setVerboseMode(boolean verboseMode)</code> described above.</p>
<p><html><head></head><body><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-log4j2logconfiguratortest-java" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-java  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tbody>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-log4j2logconfiguratortest-java-LC29" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">@Test</span></td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-log4j2logconfiguratortest-java-LC30" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testVerboseOnAndRootLoggerHasConsoleAppender</span>(){</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-log4j2logconfiguratortest-java-LC31" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Configuration</span> config <span class="pl-k">=</span> ((<span class="pl-smi">LoggerContext</span>)<span class="pl-smi">LogManager</span><span class="pl-k">.</span>getContext(<span class="pl-c1">false</span>))<span class="pl-k">.</span>getConfiguration();</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-log4j2logconfiguratortest-java-LC32" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertNotNull(log4j2VerboseConfigurator);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-log4j2logconfiguratortest-java-LC33" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertNotNull(log4jLoggerFactory);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-log4j2logconfiguratortest-java-LC34" class="blob-code blob-code-inner js-file-line">        log4j2VerboseConfigurator<span class="pl-k">.</span>setVerboseMode(<span class="pl-c1">true</span>);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-log4j2logconfiguratortest-java-LC35" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">LogManager</span><span class="pl-k">.</span>getLogger(<span class="pl-s"><span class="pl-pds">&quot;</span>com.paypal.butterfly.cli<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-log4j2logconfiguratortest-java-LC36" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertTrue(config<span class="pl-k">.</span>getLoggerConfig(<span class="pl-s"><span class="pl-pds">&quot;</span>com.paypal.butterfly.cli<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>getAppenders()<span class="pl-k">.</span>isEmpty());</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-log4j2logconfiguratortest-java-LC37" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertTrue(config<span class="pl-k">.</span>getRootLogger()<span class="pl-k">.</span>getAppenders()<span class="pl-k">.</span>get(<span class="pl-s"><span class="pl-pds">&quot;</span>DefaultConsole-2<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>getName()<span class="pl-k">.</span>compareTo(<span class="pl-s"><span class="pl-pds">&quot;</span>DefaultConsole-2<span class="pl-pds">&quot;</span></span>) <span class="pl-k">==</span> <span class="pl-c1">0</span>);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-log4j2logconfiguratortest-java-LC38" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertTrue(config<span class="pl-k">.</span>getRootLogger()<span class="pl-k">.</span>getAppenders()<span class="pl-k">.</span>get(<span class="pl-s"><span class="pl-pds">&quot;</span>Routing<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>getName()<span class="pl-k">.</span>compareTo(<span class="pl-s"><span class="pl-pds">&quot;</span>Routing<span class="pl-pds">&quot;</span></span>) <span class="pl-k">==</span> <span class="pl-c1">0</span>);</td>
      </tr>
      <tr>
        <td id="file-log4j2logconfiguratortest-java-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-log4j2logconfiguratortest-java-LC39" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/Log4j2LogConfiguratorTest.java" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2logconfiguratortest-java">Log4j2LogConfiguratorTest.java</a>
        hosted with &#x2764; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>
</body></html></p>
<p>You can see all test cases <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2logconfiguratortest-java">here</a>.</p>
<p>I have also added new test cases to check whether the actual logging is
happening as expected. Those test cases are following-</p>
<p><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-loggertest-java" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-java  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-loggertest-java-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-loggertest-java-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">/**</span></span></td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-loggertest-java-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-c"> * Tests for logging</span></td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-loggertest-java-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"> <span class="pl-c">*/</span></span></td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-loggertest-java-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-loggertest-java-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">LoggerTest</span>{</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-loggertest-java-LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-loggertest-java-LC7" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">@Test</span></td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-loggertest-java-LC8" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testLoggingToConsoleWithLevelInfo</span>() <span class="pl-k">throws</span> <span class="pl-smi">IOException</span>{</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-loggertest-java-LC9" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">PrintStream</span> originalStdOut<span class="pl-k">=</span> <span class="pl-smi">System</span><span class="pl-k">.</span>out;</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-loggertest-java-LC10" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">ByteArrayOutputStream</span> consoleContent <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ByteArrayOutputStream</span>();</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-loggertest-java-LC11" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">PrintStream</span> printToFile <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">PrintStream</span>(consoleContent);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-loggertest-java-LC12" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">System</span><span class="pl-k">.</span>setOut(printToFile);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-loggertest-java-LC13" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">LoggerFactory</span><span class="pl-k">.</span>getLogger(<span class="pl-s"><span class="pl-pds">&quot;</span>com.paypal.butterfly.cli<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>info(<span class="pl-s"><span class="pl-pds">&quot;</span>Butterfly application transformation tool<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-loggertest-java-LC14" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">System</span><span class="pl-k">.</span>setOut(originalStdOut);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-loggertest-java-LC15" class="blob-code blob-code-inner js-file-line">        printToFile<span class="pl-k">.</span>close();</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-loggertest-java-LC16" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertTrue(consoleContent<span class="pl-k">.</span>toString()<span class="pl-k">.</span>compareTo(<span class="pl-s"><span class="pl-pds">&quot;</span>Butterfly application transformation tool<span class="pl-cce">\n</span><span class="pl-pds">&quot;</span></span>)<span class="pl-k">==</span><span class="pl-c1">0</span>);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-loggertest-java-LC17" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-loggertest-java-LC18" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-loggertest-java-LC19" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">@Test</span></td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-loggertest-java-LC20" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testLoggingToFile</span>() <span class="pl-k">throws</span> <span class="pl-smi">IOException</span> {</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-loggertest-java-LC21" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">String</span> fileName <span class="pl-k">=</span> <span class="pl-smi">System</span><span class="pl-k">.</span>getProperty(<span class="pl-s"><span class="pl-pds">&quot;</span>user.dir<span class="pl-pds">&quot;</span></span>) <span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">&quot;</span>/logs/testLoggingToFile.txt<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-loggertest-java-LC22" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">String</span> testLine <span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>Butterfly application transformation tool<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-loggertest-java-LC23" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">System</span><span class="pl-k">.</span>setProperty(<span class="pl-s"><span class="pl-pds">&quot;</span>logFile<span class="pl-pds">&quot;</span></span>,fileName);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-loggertest-java-LC24" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">LoggerFactory</span><span class="pl-k">.</span>getLogger(<span class="pl-s"><span class="pl-pds">&quot;</span>root<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>error(testLine);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-loggertest-java-LC25" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">File</span> logFile <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">File</span>(fileName);</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-loggertest-java-LC26" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertTrue(logFile<span class="pl-k">.</span>exists());</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-loggertest-java-LC27" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertTrue(<span class="pl-smi">FileUtils</span><span class="pl-k">.</span>readFileToString(logFile, <span class="pl-s"><span class="pl-pds">&quot;</span>UTF-8<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>contains(<span class="pl-s"><span class="pl-pds">&quot;</span>Butterfly application transformation tool<span class="pl-pds">&quot;</span></span>));</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-loggertest-java-LC28" class="blob-code blob-code-inner js-file-line">        logFile<span class="pl-k">.</span>delete();</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-loggertest-java-LC29" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-loggertest-java-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-loggertest-java-LC30" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/LoggerTest.java" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-loggertest-java">LoggerTest.java</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>
&#x3C;code data-gist-id=“ca176a0335131a092618cb9066fc3fee”</p>
<p>Now, it is time to run the tests. When I ran the tests one of the tests
failed. This was an integration test. The following portion of the test was
failing-</p>
<p><html><head></head><body><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-failingtest-java" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-java  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tbody><tr>
        <td id="file-failingtest-java-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-failingtest-java-LC1" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">@Test</span></td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-failingtest-java-LC2" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-k">void</span> helpTest() throws <span class="pl-smi">IOException</span>, <span class="pl-smi">URISyntaxException</span> {</td>
      </tr>
      
      
      
      
      
      
      
      
      
      
      
      
      <tr>
        <td id="file-failingtest-java-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-failingtest-java-LC15" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">//</span> Capturing the console output</span></td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-failingtest-java-LC16" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">PrintStream</span> systemOut <span class="pl-k">=</span> <span class="pl-smi">System</span><span class="pl-k">.</span>out;</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-failingtest-java-LC17" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">File</span> helpOut <span class="pl-k">=</span> <span class="pl-smi">File</span><span class="pl-k">.</span>createTempFile(<span class="pl-s"><span class="pl-pds">&quot;</span>butterfly-cli-help-output<span class="pl-pds">&quot;</span></span>, <span class="pl-c1">null</span>);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-failingtest-java-LC18" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">PrintStream</span> helpStream <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">PrintStream</span>(helpOut);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-failingtest-java-LC19" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">System</span><span class="pl-k">.</span>setOut(helpStream);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-failingtest-java-LC20" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-failingtest-java-LC21" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">//</span> Running help option three times (in different ways) to capture console output</span></td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-failingtest-java-LC22" class="blob-code blob-code-inner js-file-line">        assertEquals(<span class="pl-k">new</span> <span class="pl-smi">ButterflyCliApp</span>()<span class="pl-k">.</span>run()<span class="pl-k">.</span>getExitStatus(), <span class="pl-c1">0</span>);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-failingtest-java-LC23" class="blob-code blob-code-inner js-file-line">        assertEquals(<span class="pl-k">new</span> <span class="pl-smi">ButterflyCliApp</span>()<span class="pl-k">.</span>run(<span class="pl-s"><span class="pl-pds">&quot;</span>-h<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>getExitStatus(), <span class="pl-c1">0</span>);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-failingtest-java-LC24" class="blob-code blob-code-inner js-file-line">        assertEquals(<span class="pl-k">new</span> <span class="pl-smi">ButterflyCliApp</span>()<span class="pl-k">.</span>run(<span class="pl-s"><span class="pl-pds">&quot;</span>-?<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>getExitStatus(), <span class="pl-c1">0</span>);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-failingtest-java-LC25" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-failingtest-java-LC26" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">//</span> Closing captured console output stream, and restoring original system out</span></td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-failingtest-java-LC27" class="blob-code blob-code-inner js-file-line">        helpStream<span class="pl-k">.</span>close();</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-failingtest-java-LC28" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">System</span><span class="pl-k">.</span>setOut(systemOut);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-failingtest-java-LC29" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-failingtest-java-LC30" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">//</span> Ensuring console output is as expected</span></td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-failingtest-java-LC31" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">File</span> helpBaselineOut <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">File</span>(<span class="pl-c1">this</span><span class="pl-k">.</span>getClass()<span class="pl-k">.</span>getResource(<span class="pl-s"><span class="pl-pds">&quot;</span>/helpOut.txt<span class="pl-pds">&quot;</span></span>)<span class="pl-k">.</span>toURI());</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-failingtest-java-LC32" class="blob-code blob-code-inner js-file-line">        assertTrue(<span class="pl-smi">FileUtils</span><span class="pl-k">.</span>contentEquals(helpBaselineOut, helpOut), <span class="pl-s"><span class="pl-pds">&quot;</span>Generated help differs from test baseline<span class="pl-cce">\n</span>Test baseline: <span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> helpBaselineOut <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-cce">\n</span>Generated result: <span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> helpOut <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-cce">\n</span><span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-failingtest-java-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-failingtest-java-LC33" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/FailingTest.java" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-failingtest-java">FailingTest.java</a>
        hosted with &#x2764; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>
</body></html></p>
<p>This is where I was stuck for almost 2 days. This test is checking logging to
console by first redirecting printing to console to a file and then matching the
content of that file with base output. It was failing because the log messages
printed to console was not redirecting to the file. I could not figure out why.
I went through the Log4j2 documentation multiple times, checked online. It was
painful. It took me two days to find the bug and it was a silly bug. I think
most of cases, silly bugs are difficult to find. So, the bug was in the
following line of code in <code class="language-text">log4j2.xml</code>.</p>
<div class="gatsby-highlight" data-language="xml"><pre style="counter-reset: linenumber NaN" class="language-xml line-numbers"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SYSTEM_OUT<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  .
  .
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Log4j2 has a specific attribute for <code class="language-text">ConsoleAppender</code> to allow for redirection
of <code class="language-text">System.out</code>. It is called <code class="language-text">follow=true</code>. So the fix is following-</p>
<div class="gatsby-highlight" data-language="xml"><pre style="counter-reset: linenumber NaN" class="language-xml line-numbers"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SYSTEM_OUT<span class="token punctuation">"</span></span> <span class="token attr-name">follow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  .
  .
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>As simple as that. I ran the tests again. Alas! it failed again. This time log
messages were going to the file but their sequences were messed up. It didn’t
take me long to understand that it was due to asynchronous loggers of Log4j2.
The test was written for Logback which was logging synchronously. So, obviously
it is going to fail for asynchronous logging. I did not have much knowledge
about testing asynchronous methods. So, I started searching online and reading
documentation for TestNG, the testing framework Butterfly is using. I found that
using <code class="language-text">Thread.sleep()</code> is not a good idea to test async code. Moreover, the test
was an integration test. I had no idea in how many places, I had to put
<code class="language-text">Thread.sleep()</code>. I have read in several places, that for testing purpose,
instead of async logging configuration, a synchronous logging configuration is
used. I thought this to be a better solution. Of course, there are other ways
to test async code, probably better. I need to read about them later. For, now
I am going to create a separate configuration file for testing purpose.
Everything in this file is same as <code class="language-text">log4j2.xml</code> except the loggers are not
async. So, it looked like below-</p>
<div class="gatsby-highlight" data-language="xml"><pre style="counter-reset: linenumber NaN" class="language-xml line-numbers"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.paypal.butterfly.cli<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Logger</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Routing<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Run the tests again. This time all tests passed. </p>
<p><strong>Phase 3: Removing Logback and Test files</strong></p>
<p>Alright, now that the new framework is fully functioning, it is time to remove
the old framework. This basically means removing the configuration files and
tests related to the framework. The configuration files are again <code class="language-text">logback.xml</code>,
<code class="language-text">LogFileDefiner.java</code> and <code class="language-text">LogbackLogConfigurator.java</code>. You can look at
the pull request <a href="https://github.com/paypal/butterfly/pull/367">here</a> to
see all these changes.</p>
<p>In addition to removing these files, I have to remove the framework from
dependencies. While removing, we need to remember about the transitive
dependencies. A portion of Logback was added as direct dependency in the
<code class="language-text">build.gradle</code> file as below-</p>
<p><html><head></head><body><div id="gist106652245" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-build-gradle" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-gradle  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tbody><tr>
        <td id="file-build-gradle-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-build-gradle-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en">dependencies</span> {</td>
      </tr>
      
      
      
      
      
      
      
      
      
      
      <tr>
        <td id="file-build-gradle-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-build-gradle-LC12" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">logback</span>: <span class="pl-s"><span class="pl-pds">&quot;</span>ch.qos.logback:logback-classic:1.1.7<span class="pl-pds">&quot;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-build-gradle-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-build-gradle-LC13" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/build.gradle" style="float:right">view raw</a>
        <a href="https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-build-gradle">build.gradle</a>
        hosted with &#x2764; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>
</body></html></p>
<p>So, I removed this. Next to check the transitive dependencies in gradle, I ran
<code class="language-text">gradle dependencies</code> and found the following-</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7c3620160dfe990c095f8258ec6900b7/302a4/logbackDependency.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 5.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsSAAALEgHS3X78AAAARUlEQVQI1zXFQQ6AIAwEQP//OoFUPQG29KC0fGElJB4ms7kp+iNgzjgvQoj7FJaUIugglJohwmgq0KneBWYvxjC49/XvA16xSMADDpVfAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Logback transitive
dependency"
        title="Logback transitive
    dependency"
        src="/static/7c3620160dfe990c095f8258ec6900b7/f058b/logbackDependency.png"
        srcset="/static/7c3620160dfe990c095f8258ec6900b7/c26ae/logbackDependency.png 158w,
/static/7c3620160dfe990c095f8258ec6900b7/6bdcf/logbackDependency.png 315w,
/static/7c3620160dfe990c095f8258ec6900b7/f058b/logbackDependency.png 630w,
/static/7c3620160dfe990c095f8258ec6900b7/40601/logbackDependency.png 945w,
/static/7c3620160dfe990c095f8258ec6900b7/302a4/logbackDependency.png 1080w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>So, Logback-core was brought by Spring framework as transitive dependency. I
needed to remove that too like below in the <code class="language-text">build.gradle</code> file.</p>
<div class="gatsby-highlight" data-language="groovy"><pre style="counter-reset: linenumber NaN" class="language-groovy line-numbers"><code class="language-groovy">  compile <span class="token punctuation">(</span>lib<span class="token punctuation">.</span>spring_boot_starter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">exclude</span><span class="token punctuation">(</span>module<span class="token punctuation">:</span><span class="token string">'logback-classic'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Alright, now that the old framework and tests files related to it were removed,
it is time to run the tests again. I ran the tests and all tests passed.
Great.</p>
<h3>Opening PR</h3>
<p>Before I pushed my code to Github, I double checked my codes to make sure, I am
not adding anything unnecessary. Then I rebased my work on the <code class="language-text">develop</code> branch
and combined all my commits into one single commit and pushed to Github. Finally
I created a pull request against the <code class="language-text">develop</code> branch. You can see the pull request
<a href="https://github.com/paypal/butterfly/pull/367">here</a>.</p>
<h3>My learning</h3>
<p>This pull request is the biggest one I have done so far. Before I started
working on this issue, I knew nothing about logging. I now have fair
understanding of Logback, Log4j2 and SLF4J. I have also used the testing
framework TestNG. My knowledge about Gradle has also enhanced. Apart from that
navigating the code base, understanding how things are working and determining
what to change and how is very critical. Overall, this PR was full of learning
for me and I feel good about it.</p></section><hr/></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/2020/fixing-telescope-issues/2020-11-21-Fixing-Telescope-Issues/">← <!-- -->Fixing Issue in Telescope</a></li><li><a rel="next" href="/2020/butterfly-bug-fix/2020-11-22-butterfly-bug-fixed/">PayPal/Butterfly Bug Fixed, Finally<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2021<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.com">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020/new-feature-butterfly/2020-11-21-new-feature-butterfly/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9524f89a0a3261402e06.js"],"app":["/app-f5f821bb311f1100b7dc.js"],"component---src-pages-404-js":["/component---src-pages-404-js-bc45a49e06f8074d13ca.js"],"component---src-pages-about-js":["/component---src-pages-about-js-1845860d3e5bdc0166ab.js"],"component---src-pages-index-js":["/component---src-pages-index-js-54b434b1cd32d596e7bc.js"],"component---src-pages-myworks-js":["/component---src-pages-myworks-js-363daa4de28034682c76.js"],"component---src-pages-resume-js":["/component---src-pages-resume-js-a6af80cdc30df3cece51.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-56e2d63e1a4fbe5a97c8.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-268f5e1953032018ad23.js"]};/*]]>*/</script><script src="/polyfill-9524f89a0a3261402e06.js" nomodule=""></script><script src="/webpack-runtime-bf77c3c8088178818b5c.js" async=""></script><script src="/styles-7d4153d260c0197f0043.js" async=""></script><script src="/framework-29ba174b433dc5858bed.js" async=""></script><script src="/app-f5f821bb311f1100b7dc.js" async=""></script><script src="/1943edf48358ec375759a10206b57d36c98a5e6d-8d80c533ddab81581c78.js" async=""></script><script src="/93241701166c3169d92c9fdd395837837cace836-d57e403f6b3df0c7cfb5.js" async=""></script><script src="/component---src-templates-blog-post-js-268f5e1953032018ad23.js" async=""></script></body></html>