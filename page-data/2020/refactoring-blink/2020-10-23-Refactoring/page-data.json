{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/refactoring-blink/2020-10-23-Refactoring/","result":{"data":{"site":{"siteMetadata":{"title":"Blog of Badal Sarkar"}},"markdownRemark":{"id":"e5d3497d-e4ab-553b-a51d-1bac4eb895c1","excerpt":"This blog is about refactoring the codes of Blink and usage of some Git commands\nwhich helps to manipulate already committed codes, more specifically  and…","html":"<p>This blog is about refactoring the codes of Blink and usage of some Git commands\nwhich helps to manipulate already committed codes, more specifically <code class=\"language-text\">git\nrebase</code> and <code class=\"language-text\">git commit --amend</code>.</p>\n<h4>Refactoring</h4>\n<p>My goal is to refactor the codes so that it becomes more maintainable.\nCurrently, the code base of Blink is organized into following modules-</p>\n<ul>\n<li><code class=\"language-text\">App.java</code> : Entry point of the application</li>\n<li><code class=\"language-text\">Environment.java</code>: Responsible for maintaining environmental variables</li>\n<li><code class=\"language-text\">CliParser.java</code>: Responsible for constructing command line argument and\nparsing arguments</li>\n<li><code class=\"language-text\">FileParser.java</code>: Responsible for parsing files</li>\n<li><code class=\"language-text\">Checker.java</code>: Responsible for checking URLs</li>\n<li><code class=\"language-text\">Writer.java</code>: Provides functionality to write to file</li>\n<li><code class=\"language-text\">HttpStatusToText.java</code>: Maps HTTP status code to descriptive text e.g. <code class=\"language-text\">200</code>\nmaps to <code class=\"language-text\">GOOD</code>.</li>\n<li><code class=\"language-text\">PrintColor.java</code>: Stores color configuration and attach colors to HTTP codes\ne.g. <code class=\"language-text\">200</code> has color <code class=\"language-text\">green</code>.</li>\n<li><code class=\"language-text\">UrlStatus.java</code>: Stores information about an URL.</li>\n<li><code class=\"language-text\">UrlPrinter.java</code>: Stores configuration for printing an URL to screen.</li>\n</ul>\n<p>Each of the classes has a specific responsibility and the classes are small.\nHowever, I noticed  there is a bug in the <code class=\"language-text\">extractAllVariables()</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// extracts all variables</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">extractAllVariables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cliColor <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CLICOLOR\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token operator\">?</span><span class=\"token boolean\">true</span><span class=\"token operator\">:</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>There can be <code class=\"language-text\">NullPointerException</code> if the <code class=\"language-text\">CLICOLOR</code> environmental variable is\nnot set. So, I added a null pointer check.</p>\n<p><strong>Loose coupling of <code class=\"language-text\">CliParser</code></strong></p>\n<p>I implemented <code class=\"language-text\">CliParser</code> using <a href=\"http://commons.apache.org/proper/commons-cli/\">Apache Commons\nCLI</a>. My <code class=\"language-text\">App</code> class was\ninteracting directly with the implementation. I think this is bad. For any\nreason, if I need to change the implementation of my cli parser, I also need to\nmake change to my <code class=\"language-text\">App</code> class. My <code class=\"language-text\">App</code> should rather interact with an interface\nso that it doesn’t need to know anything about the implementation of cli parser.\nFor this, I created an interface <code class=\"language-text\">CliParser</code> which provides some methods that\nwill be used by the application. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\">  <span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CliParser</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">void</span> <span class=\"token function\">registerCliOption</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CliOption</span> option<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">void</span> <span class=\"token function\">defineCliOptionWithArgument</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CliOption</span> option<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">void</span> <span class=\"token function\">defineCliGroupOption</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CliOption</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">void</span> <span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">boolean</span> <span class=\"token function\">isCliOptionSet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CliOption</span> option<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">String</span> <span class=\"token function\">getCliOptionArgValue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CliOption</span> option<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">void</span> <span class=\"token function\">printHelp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I created <code class=\"language-text\">CliParserImpl</code>\n<a href=\"https://github.com/badalsarkar/Blink/blob/master/src/main/java/com/badalsarkar/CliParserImpl.java\">class</a>\nwhich implements the interface using the <a href=\"http://commons.apache.org/proper/commons-cli/\">Apache Commons\nCLI</a>. Now, if I need to\nchange my implementation for example if I want use different library, I can\neasily do that. The implementation must implement the interface and my\napplication is interacting with the interface. This is more maintainable.</p>\n<p><strong>Removing dead code</strong></p>\n<p>In some of my classes, there were some unused codes. I removed those to clean\nthings up.</p>\n<h4>Working with Git History</h4>\n<p>All my refactoring work was done in a feature branch called <code class=\"language-text\">refactoring</code>. I\nmade total 3 commits. But at the end all those commits were for the same\npurpose- to refactor codes. So, instead of having 3 different commits, I have\nput them together in a single commit. This keeps git history nice and clean. To\ncombine multiple commits into one, we can use <code class=\"language-text\">git rebase --interactive</code>\n<a href=\"https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History\">command</a>. After\ncombining my commits looks like below-</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67c77487fdeb1209d946a2e9b6a15b6d/96658/rebaseCommit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAxElEQVQY022P226EMAxE+f+vK5BwXeLEiQNSC7t/MDWh6m334ciaeTjyVFuekUIL4UZvAwlviCW3CFSDfY0cDVbpcRwf2PeT98KZ/1OJMIbBYr4NGKcO1tbouhZ9b2BMDWMbrJmRc/wS/sheiSvnFnBkxHQROEAkqUAgiveEbVvxeBzfgt/Cpw+JFvhARZYU8k6FEUE7jkGvB7O/+pxwv+9/ZE8fDmOvcyc4d4PtLJZlLqIzT/OIc0HUfMmpdESuiF9N/gQ/e2+eMFfMbgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Rebase Commit \"\n        title=\"Rebase Commit\"\n        src=\"/static/67c77487fdeb1209d946a2e9b6a15b6d/f058b/rebaseCommit.png\"\n        srcset=\"/static/67c77487fdeb1209d946a2e9b6a15b6d/c26ae/rebaseCommit.png 158w,\n/static/67c77487fdeb1209d946a2e9b6a15b6d/6bdcf/rebaseCommit.png 315w,\n/static/67c77487fdeb1209d946a2e9b6a15b6d/f058b/rebaseCommit.png 630w,\n/static/67c77487fdeb1209d946a2e9b6a15b6d/96658/rebaseCommit.png 881w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The commit shows all three commit messages from three commits. We can further\nclean it up by just putting one commit message in stead of three. <code class=\"language-text\">git commit\n--amend</code> is the\n<a href=\"https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History\">command</a> for this.\nThis lets us edit the commit message. After modification my commit looks like\nbelow-</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f4f778254dcabf182d3149cccd89c5d6/efc66/commitAmend.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.29113924050633%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAi0lEQVQI12WMbQ7CIBBEuf/VjAYTS1lp5aNAo9D2CFPA1KTxx8vM7mYfi55gxhucucNqDvvi0MO17Qa6QI8c3nLMgbBtC9Y1n1iWdJrZ5B3o2UMNBKUIvewgpSgp0IkHJPWI0Tdy/iCl9486H9JDzKzVqNIQfMPXHmufSv9S79aZlq6kKT+VeY5/wh3QetvS21N2iAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Commit Amend \"\n        title=\"Commit Amend\"\n        src=\"/static/f4f778254dcabf182d3149cccd89c5d6/f058b/commitAmend.png\"\n        srcset=\"/static/f4f778254dcabf182d3149cccd89c5d6/c26ae/commitAmend.png 158w,\n/static/f4f778254dcabf182d3149cccd89c5d6/6bdcf/commitAmend.png 315w,\n/static/f4f778254dcabf182d3149cccd89c5d6/f058b/commitAmend.png 630w,\n/static/f4f778254dcabf182d3149cccd89c5d6/efc66/commitAmend.png 885w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Next, I merged the <code class=\"language-text\">refactoring</code> branch to the <code class=\"language-text\">master</code> branch and pushed it to\nthe remote server.</p>","frontmatter":{"title":"Refactoring and Rewritting Git History","date":"October 23, 2020","description":null}},"previous":{"fields":{"slug":"/2020/release-02/"},"frontmatter":{"title":"Release 0.2 Week 1"}},"next":{"fields":{"slug":"/2020/working-in-thaw/2020-10-29-Release.0-secondPR/"},"frontmatter":{"title":"Release 0.2- Implementing new feature in open source project Thaw"}}},"pageContext":{"id":"e5d3497d-e4ab-553b-a51d-1bac4eb895c1","previousPostId":"260b714f-bc88-56d1-aa5f-6c3160e9b9d8","nextPostId":"4dd9d7c9-bef3-53d5-adab-6046b3bcf289"}},"staticQueryHashes":["2841359383","916993862"]}