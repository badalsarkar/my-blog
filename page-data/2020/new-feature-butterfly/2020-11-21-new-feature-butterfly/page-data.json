{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/new-feature-butterfly/2020-11-21-new-feature-butterfly/","result":{"data":{"site":{"siteMetadata":{"title":"Blog of Badal Sarkar"}},"markdownRemark":{"id":"be590607-bce0-5221-9b21-b41fcfa398ed","excerpt":"I have been working on Paypal/Butterfly\nproject for about a month. Previously I have fixed two\nbugs\nand this time I am implementing a new\nfeature. The task is…","html":"<p>I have been working on <a href=\"https://github.com/paypal/butterfly\">Paypal/Butterfly</a>\nproject for about a month. Previously I have fixed <a href=\"https://github.com/pulls?q=is%3Apr+author%3Abadalsarkar+archived%3Afalse+is%3Aclosed+repo%3Apaypal%2Fbutterfly\">two\nbugs</a>\nand this time I am implementing a <a href=\"https://github.com/paypal/butterfly/issues/314\">new\nfeature</a>. The task is to replace\nexisting logging framework, <a href=\"http://logback.qos.ch/\">Logback</a>, with\n<a href=\"https://logging.apache.org/log4j/2.x/index.html\">Log4j2</a>.</p>\n<h3>Logging frameworks</h3>\n<p>Logging in Java requires using a <a href=\"https://en.wikipedia.org/wiki/Java_logging_framework\">logging\nframework</a>. There are many\nlogging frameworks to choose from. Java provides a built in framework in\n<code class=\"language-text\">java.util.logging</code> package. There are also third party logging frameworks like\nLog4j, Logback, tinylog, Apache Commons Logging, SLF4J.</p>\n<p>All these frameworks except SLF4J provide fundamental logging functionality with\ndifferences in features and performance. SLF4J is a facade for various logging\nframeworks.  It provides interfaces which various frameworks implement and thus\nenables end users to use desired framework during deployment time. Programming\nagainst SLF4J interfaces also means that end users can switch to a different\nlogging framework without changing all the codes for logging. An example\nwill make it clear.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Logger</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloWorld</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloWorld</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The above code example from SLF4J website, shows that we are logging an info\n“Hello World” using SLF4J API <a href=\"http://www.slf4j.org/apidocs/org/slf4j/LoggerFactory.html\"><code class=\"language-text\">LoggerFactory</code></a>.\nBehind the scene, we can use\nany of the above mentioned frameworks which provides implementation for SLF4J\ninterfaces. Lets say we want to use Logback. All we need to do is provide the\nconfiguration file <code class=\"language-text\">logback.xml</code>. Again, if we decide to switch from Logback to\nLog4j2, all we need to do is replace configuration of Logback with Log4j2. Our\ncode above doesn’t need to change. So, using SLF4J API instead of framework\nspecific API provides huge flexibility.</p>\n<h3>Why Butterfly wants to use Log4j2</h3>\n<blockquote>\n<p>Apache Log4j2 is an upgrade to Log4j that provides significant improvements\nover its predecessor, Log4j 1.x, and provides many of the improvements\navailable in Logback while fixing some inherent problems in Logback’s\narchitecture.</p>\n</blockquote>\n<p>Log4j2 offers many improvements including better performance. Its asynchronous\nlogger’s performance is impressive. The following comparision, of different\nlogging library performance gives some idea.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB50lEQVQoz3VSCY7TQBD0/1/BBxCHRFjQci6wBIVNopBscOIjPnP4GNvx+opdTLcJQiK01HKpx1NTXd1KWZboug5VVUFVVRiGgeVyybler/m7WCz+YF2e0z/z+Ry2ZWE2m+FwOOB0OjGHIoRAFEVcCIIAcRzDcRz4vg868zwP2+0WYRgyjqKQ61RL0hS73Q75wwPOoVDBtm1mpyC157iEw7TEXhQ9DmMkieAHkiRBXddQ6GUiJcKmaTjp4Iz/rqE7wfAFVq5AVxfQVj/ZAk3TWH2WZT0htUcX2rbl1i8lkVJoaxfzbz8Y244r/dszGanklslQKpDC88XLWfMF9d7E5N2QcSwSHKWqVHp5PB7ZFoWG0Ldc/6OIsVTdtidpfIWsaGCoFiYfRvhfKDRhmioRdF2Lpu6JaQSEK7lWFPs4x/ebMcx7HePfhIlUSILINso8z3uFvAIik7L78RdZDrENsF65CJYqzJkqfY4xlUTWUsf05o7/M3Sdd1eX381mw/uo0GTKusKnVx/x6PEVvg5HGA2nuHo2wOvbCW7fvsf102u8Gd7h5YsBvnweY/DkOUKpvpT7R/6dB8YtF0XBLUZSsuO6sOT2O64Hy7Hh+B5M+bLn+TBtCxanA9M0EScpb0Uj79KGUNJgfwESfT6GXYNgCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Logging library performance comparision\"\n        title=\"Logging library performance comparision\"\n        src=\"/static/3d08e29f23e9800d8c47ea7dd033edaf/f058b/loggingLibraryPerformance.png\"\n        srcset=\"/static/3d08e29f23e9800d8c47ea7dd033edaf/c26ae/loggingLibraryPerformance.png 158w,\n/static/3d08e29f23e9800d8c47ea7dd033edaf/6bdcf/loggingLibraryPerformance.png 315w,\n/static/3d08e29f23e9800d8c47ea7dd033edaf/f058b/loggingLibraryPerformance.png 630w,\n/static/3d08e29f23e9800d8c47ea7dd033edaf/40601/loggingLibraryPerformance.png 945w,\n/static/3d08e29f23e9800d8c47ea7dd033edaf/38124/loggingLibraryPerformance.png 953w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nsource: <a href=\"https://logging.apache.org/log4j/2.x/performance.html\">https://logging.apache.org/log4j/2.x/performance.html</a></p>\n<p>You can also read about performance <a href=\"https://logging.apache.org/log4j/2.x/performance.html\">here</a>.\nButterfly wants to take advantage of the improved performance specially the fast\nasynchronous logging.</p>\n<h3>How Butterfly is using Logback</h3>\n<p>Butterfly is using SLF4J API with Logback implementation. The Logback\nconfiguration file <code class=\"language-text\">logback.xml</code> has the following contents.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e7eface7d5834631beca33119826ed8/afa26/logBackConfig.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABIUlEQVQoz41Si26DMAzs/3/qpiECcR6Ow+3s7tV2KrVkEQK53MMXHYplT1i3jFI6qiiyVKgOzDmjzSaGWbS/H8cBr+/n37r4Zh8dpTWU2tG6ojcjaAtg35Ny/Zb57LzoFLD0ijVvWFchU4FkHs4t1t5pLw+H/wMLwJB1GD62BWtK2HMmyx7dnS27cm0h9Qr0lKHRF5sEzAuZFgIQjPJ7ANLTWsOSecynzH4l8+aiFUl2HnY2iqEHalMIfXPP5Ms/V3MGevEE/ce39I5EH0UkPLVI9CrP5dpJujceuqStZLLRGBcdI0Zlfo3LK2HcAFZtnMWV0phsEiwpx/hoN/qpD8xeYKiUm9nCIEbIu68zZjcpV3qWyhbAjYBj2A/I2Zjc1yc45GOwyDHTAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Butterfly logback configuration file\"\n        title=\"Butterfly Logback configuration file\"\n        src=\"/static/1e7eface7d5834631beca33119826ed8/f058b/logBackConfig.png\"\n        srcset=\"/static/1e7eface7d5834631beca33119826ed8/c26ae/logBackConfig.png 158w,\n/static/1e7eface7d5834631beca33119826ed8/6bdcf/logBackConfig.png 315w,\n/static/1e7eface7d5834631beca33119826ed8/f058b/logBackConfig.png 630w,\n/static/1e7eface7d5834631beca33119826ed8/40601/logBackConfig.png 945w,\n/static/1e7eface7d5834631beca33119826ed8/afa26/logBackConfig.png 1258w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Lets see what these configurations mean.</p>\n<ul>\n<li>At line 4, a property named <code class=\"language-text\">logFile</code> is defined. The value of <code class=\"language-text\">logFile</code> is\ncalculated dynamically at runtime by\n<code class=\"language-text\">LogFileDefiner</code> class.</li>\n<li>At line 6, a pattern for timestamp is defined.</li>\n<li>Line 8 to 13 defines an <code class=\"language-text\">Appender</code> named <code class=\"language-text\">FILE</code> which is an instance of\n<a href=\"http://logback.qos.ch/manual/appenders.html#FileAppender\"><code class=\"language-text\">FileAppender</code></a> class\nof Logback. The task of an <code class=\"language-text\">Appender</code> is to take a logging\nevent and process it. So, the <code class=\"language-text\">FILE</code> appender in this case, processes an event\nby saving it in <code class=\"language-text\">logFile</code>(line 9) using the pattern specified in line 11.</li>\n<li>Line 15 to 19 defines another <code class=\"language-text\">Appender</code> named <code class=\"language-text\">CONSOLE</code>, an instance of\n<a href=\"http://logback.qos.ch/manual/appenders.html#ConsoleAppender\"><code class=\"language-text\">ConsoleAppender</code></a>\nclass of Logback, which processes a logging event by printing\nto console using the specified pattern.</li>\n<li>Line 21 to 23 defines a\n<a href=\"http://logback.qos.ch/apidocs/ch/qos/logback/classic/Logger.html\"><code class=\"language-text\">Logger</code></a>\nnamed <code class=\"language-text\">com.paypal.butterfly.cli</code> with level <code class=\"language-text\">INFO</code>. A logger is an object which\nis used by the application to log an event. An event can be marked by\ndifferent levels like <code class=\"language-text\">INFO</code>,<code class=\"language-text\">ERROR</code>,<code class=\"language-text\">DEBUG</code>,<code class=\"language-text\">TRACE</code> etc. When a logger receives\nan event from the application it forwards that to the appenders registered with it.\nIn this example, there is one registered appender- <code class=\"language-text\">CONSOLE</code> configured in line\n15-19. So, when the application passes an event to <code class=\"language-text\">com.paypal.butterfly.cli</code>\nlogger, it will print it to the console.</li>\n<li>Line 25 to 27 defines a <code class=\"language-text\">root</code> logger with level <code class=\"language-text\">ERROR</code> and it has one\nregistered appender- <code class=\"language-text\">FILE</code>. So, this logger will store log events to the\n<code class=\"language-text\">logFile</code>. Notice <code class=\"language-text\">root</code> logger has no name.</li>\n</ul>\n<p>In addition to the above configuration file, Butterfly has two other\nconfiguration files- LogFileDefiner.java and LogbackLogConfigurator.java.</p>\n<p><code class=\"language-text\">LogFileDefiner</code> class provides functionality to define a log file at runtime.\nThis log file is the file used in logback.xml line 4. You can check the full\ncode\n<a href=\"https://gist.github.com/badalsarkar/8d2dab5f4fda510d1820e046b1aaa688\">here</a>.\n<code class=\"language-text\">LogFileDefiner</code> class implements <code class=\"language-text\">PropertyDefiner</code> interface of Logback. This\ninterface provides an abstract function <code class=\"language-text\">public String getPropertyValue()</code> which\nloads the value of <code class=\"language-text\">logFile</code> defined at line 4.</p>\n<p>LogbackLogConfigurator.java defines several methods to change some Logback\nconfigurations at runtime such as changing log level and changing root logger’s\nappender to file. You can take a look at the code <a href=\"https://gist.github.com/badalsarkar/dbf8371bb4059f714175852a43305b14\">here</a>.</p>\n<h3>How I implemented Log4j2</h3>\n<p>Log4j2 also provides <a href=\"https://logging.apache.org/log4j/2.x/log4j-slf4j-impl/apidocs/index.html\">implementation for SLF4J API</a>.\nTherefore, the work is mainly related to configuration files and test files.\nI planned the work in 3 phases-</p>\n<ol>\n<li>Add Log4j2</li>\n<li>Add tests for new implementation and modify existing tests</li>\n<li>Remove Logback and related tests</li>\n</ol>\n<p><strong>Phase 1: Add Log4j2</strong></p>\n<p>Butterfly uses <a href=\"\">Gradle</a> as build tool. I added the following dependencies in\nthe <code class=\"language-text\">build.gradle</code> file.</p>\n<p><html><head></head><body><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-build-gradle\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-gradle  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tbody><tr>\n        <td id=\"file-build-gradle-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-build-gradle-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-en\">dependencies</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-build-gradle-LC2\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c1\">log4j_api</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>org.apache.logging.log4j:log4j-api:2.14.0<span class=\"pl-pds\">&quot;</span></span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-build-gradle-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c1\">log4j_core</span>:<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>org.apache.logging.log4j:log4j-core:2.14.0<span class=\"pl-pds\">&quot;</span></span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-build-gradle-LC4\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-build-gradle-LC5\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> for using SLF4J API with Log4j2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-build-gradle-LC6\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c1\">log4j_slf4j_impl</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>org.apache.logging.log4j:log4j-slf4j-impl:2.14.0<span class=\"pl-pds\">&quot;</span></span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-build-gradle-LC7\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-build-gradle-LC8\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> for async log4j2 logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-build-gradle-LC9\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c1\">disruptor</span>:<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>com.lmax:disruptor:3.3.4<span class=\"pl-pds\">&quot;</span></span>,</td>\n      </tr>\n      \n      \n      \n      <tr>\n        <td id=\"file-build-gradle-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-build-gradle-LC13\" class=\"blob-code blob-code-inner js-file-line\">}</td>\n      </tr>\n</tbody></table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/build.gradle\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-build-gradle\">build.gradle</a>\n        hosted with &#x2764; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</body></html></p>\n<p>Next I added the following configuration file named <code class=\"language-text\">log4j2.xml</code>. Note, there is\na bug at line 5. I talked about it later in the blog.</p>\n<p><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-log4j2-xml\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-xml  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-log4j2-xml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-log4j2-xml-LC1\" class=\"blob-code blob-code-inner js-file-line\">&lt;?<span class=\"pl-ent\">xml</span><span class=\"pl-e\"> version</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>1.0<span class=\"pl-pds\">&quot;</span></span><span class=\"pl-e\"> encoding</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>UTF-8<span class=\"pl-pds\">&quot;</span></span>?&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-log4j2-xml-LC2\" class=\"blob-code blob-code-inner js-file-line\">&lt;<span class=\"pl-ent\">configuration</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-log4j2-xml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  &lt;<span class=\"pl-ent\">Appenders</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-log4j2-xml-LC4\" class=\"blob-code blob-code-inner js-file-line\">   <span class=\"pl-c\"><span class=\"pl-c\">&lt;!--</span> This line failed a test case <span class=\"pl-c\">--&gt;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-log4j2-xml-LC5\" class=\"blob-code blob-code-inner js-file-line\">    &lt;<span class=\"pl-ent\">Console</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>CONSOLE<span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-e\">target</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>SYSTEM_OUT<span class=\"pl-pds\">&quot;</span></span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-log4j2-xml-LC6\" class=\"blob-code blob-code-inner js-file-line\">\t  &lt;<span class=\"pl-ent\">PatternLayout</span> <span class=\"pl-e\">pattern</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>%msg%n<span class=\"pl-pds\">&quot;</span></span> /&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-log4j2-xml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    &lt;/<span class=\"pl-ent\">Console</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-log4j2-xml-LC8\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-log4j2-xml-LC9\" class=\"blob-code blob-code-inner js-file-line\">    &lt;<span class=\"pl-ent\">Routing</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Routing<span class=\"pl-pds\">&quot;</span></span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-log4j2-xml-LC10\" class=\"blob-code blob-code-inner js-file-line\">      &lt;<span class=\"pl-ent\">Routes</span> <span class=\"pl-e\">pattern</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>$${sys:logFile}<span class=\"pl-pds\">&quot;</span></span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-log4j2-xml-LC11\" class=\"blob-code blob-code-inner js-file-line\">        &lt;<span class=\"pl-ent\">Route</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-log4j2-xml-LC12\" class=\"blob-code blob-code-inner js-file-line\">          &lt;<span class=\"pl-ent\">RandomAccessFile</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>File<span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-e\">fileName</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>${sys:logFile}<span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-e\">immediateFlush</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>false<span class=\"pl-pds\">&quot;</span></span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-log4j2-xml-LC13\" class=\"blob-code blob-code-inner js-file-line\">            &lt;<span class=\"pl-ent\">PatternLayout</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-log4j2-xml-LC14\" class=\"blob-code blob-code-inner js-file-line\">                &lt;<span class=\"pl-ent\">pattern</span>&gt;[%d{HH:mm:ss.SSS}] [%-4level] %msg%n&lt;/<span class=\"pl-ent\">pattern</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-log4j2-xml-LC15\" class=\"blob-code blob-code-inner js-file-line\">            &lt;/<span class=\"pl-ent\">PatternLayout</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-log4j2-xml-LC16\" class=\"blob-code blob-code-inner js-file-line\">          &lt;/<span class=\"pl-ent\">RandomAccessFile</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-log4j2-xml-LC17\" class=\"blob-code blob-code-inner js-file-line\">        &lt;/<span class=\"pl-ent\">Route</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-log4j2-xml-LC18\" class=\"blob-code blob-code-inner js-file-line\">      &lt;/<span class=\"pl-ent\">Routes</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-log4j2-xml-LC19\" class=\"blob-code blob-code-inner js-file-line\">    &lt;/<span class=\"pl-ent\">Routing</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-log4j2-xml-LC20\" class=\"blob-code blob-code-inner js-file-line\">  &lt;/<span class=\"pl-ent\">Appenders</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-log4j2-xml-LC21\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-log4j2-xml-LC22\" class=\"blob-code blob-code-inner js-file-line\">  &lt;<span class=\"pl-ent\">Loggers</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-log4j2-xml-LC23\" class=\"blob-code blob-code-inner js-file-line\">    &lt;<span class=\"pl-ent\">AsyncLogger</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>com.paypal.butterfly.cli<span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-e\">level</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>INFO<span class=\"pl-pds\">&quot;</span></span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-log4j2-xml-LC24\" class=\"blob-code blob-code-inner js-file-line\">      &lt;<span class=\"pl-ent\">AppenderRef</span> <span class=\"pl-e\">ref</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>CONSOLE<span class=\"pl-pds\">&quot;</span></span> /&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-log4j2-xml-LC25\" class=\"blob-code blob-code-inner js-file-line\">    &lt;/<span class=\"pl-ent\">AsyncLogger</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-log4j2-xml-LC26\" class=\"blob-code blob-code-inner js-file-line\">    &lt;<span class=\"pl-ent\">AsyncRoot</span> <span class=\"pl-e\">level</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>ERROR<span class=\"pl-pds\">&quot;</span></span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-log4j2-xml-LC27\" class=\"blob-code blob-code-inner js-file-line\">      &lt;<span class=\"pl-ent\">AppenderRef</span> <span class=\"pl-e\">ref</span>=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Routing<span class=\"pl-pds\">&quot;</span></span> /&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-log4j2-xml-LC28\" class=\"blob-code blob-code-inner js-file-line\">    &lt;/<span class=\"pl-ent\">AsyncRoot</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-log4j2-xml-LC29\" class=\"blob-code blob-code-inner js-file-line\">  &lt;/<span class=\"pl-ent\">Loggers</span>&gt;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2-xml-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-log4j2-xml-LC30\" class=\"blob-code blob-code-inner js-file-line\">&lt;/<span class=\"pl-ent\">configuration</span>&gt;</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/log4j2.xml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2-xml\">log4j2.xml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>The concept behind this configuration file is similar to the one described\nabove for Logback. In a nutshell, the configuration is doing the following-</p>\n<ul>\n<li>Define a console appender and routing appender [line 3 to 19]</li>\n<li>Define two asynchronous loggers- <code class=\"language-text\">com.paypal.butterfly.cli</code> and <code class=\"language-text\">root</code></li>\n</ul>\n<p><a href=\"https://logging.apache.org/log4j/2.x/manual/appenders.html#RoutingAppender\">Routing appender</a> at line 8\nneeds some explanation. The root logger at line 25 uses routing appender to store\nlog events to the <code class=\"language-text\">logFile</code>. The application requirement is to set the log file\ndynamically at runtime. It was easy to do so in Logback as we have seen in <code class=\"language-text\">logback.xml</code>.\nIn Log4j2, I could not find a way to update the <code class=\"language-text\">logFile</code> at runtime. So, I\nwrapped the <code class=\"language-text\">RandomAccessFile</code> (faster than <code class=\"language-text\">File</code>) appender with <code class=\"language-text\">Routing</code> appender.</p>\n<p>This appender can have multiple routes, and a route is selected by matching the\n<code class=\"language-text\">pattern</code> attribute, in our case at line 9. A route basically determines how a log\nevent will be processed by using other appenders e.g. console, file etc. In our\ncase there is only one route which process a log event using <code class=\"language-text\">RandomAccessFile</code>\nappender. So, when the root logger passes a log event to routing appender, it\nforwards the event to the RandomAccessFile appender which gets the log file name\nby evaluating the expression <code class=\"language-text\">${sys:logFile}</code> and store the log in the file. How\nis this expression evaluated?</p>\n<p>In Log4j2, this expression is used for property lookup. <a href=\"https://logging.apache.org/log4j/2.x/manual/lookups.html\">There are several lookup options\nto choose from</a>.  This\nparticular lookup is done in system property. The application will store the\nname of the log file in the system property called <code class=\"language-text\">logFile</code>. Then\n<code class=\"language-text\">RandomAccessFile</code> appender can access that system property to get the file\nname.</p>\n<p>Now, that Log4j2 is configured, there are two other\nconfiguration files- <code class=\"language-text\">LogFileDefiner.java</code> and <code class=\"language-text\">LogbackLogConfigurator.java</code>.\nI need to define new configuration to replace those files.</p>\n<p><strong>LogFileDefiner</strong></p>\n<p>The main function of <code class=\"language-text\">LogFileDefiner</code> class is to expose methods to manipulate\nlog file name like setting log file name, getting file name etc. These are\nsimple getter and setter methods. In the previous section we have seen that we\nneed to store the log file name to system property named <code class=\"language-text\">logFile</code>. This done by\nthe following function-</p>\n<p><html><head></head><body><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-logfiledefiner-java\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-java  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tbody>\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      <tr>\n        <td id=\"file-logfiledefiner-java-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-logfiledefiner-java-LC35\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">void</span> <span class=\"pl-en\">updateLog4jConfigWithLogFile</span>(){</td>\n      </tr>\n      <tr>\n        <td id=\"file-logfiledefiner-java-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-logfiledefiner-java-LC36\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>setProperty(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>logFile<span class=\"pl-pds\">&quot;</span></span>,<span class=\"pl-smi\">LogFileDefiner</span><span class=\"pl-k\">.</span>getLogFile()<span class=\"pl-k\">.</span>getAbsolutePath());</td>\n      </tr>\n      <tr>\n        <td id=\"file-logfiledefiner-java-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-logfiledefiner-java-LC37\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n      \n</tbody></table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/LogFileDefiner.java\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-logfiledefiner-java\">LogFileDefiner.java</a>\n        hosted with &#x2764; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</body></html>\n<code data-gist-id=\"ca176a0335131a092618cb9066fc3fee\"\ndata-gist-file=\"LogFileDefiner.java\" data-gist-line=\"35-37\"></code></p>\n<p>Then I am calling this function from the <code class=\"language-text\">main</code> method. You can take a look at\nthe full code\n<a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-logfiledefiner-java\">here</a>.</p>\n<p><strong>Log4j2LogConfigurator</strong></p>\n<p>This class exposes methods to change some logging configurations at runtime. I\nhave kept the function signature same as before but changed the implementation.\nTo give an example, the <code class=\"language-text\">root</code> logger uses <code class=\"language-text\">RandomAccessFile</code> as appender. The\napplication has a requirement to attach <code class=\"language-text\">ConsoleAppender</code> to root logger at\nruntime. It is done by the following method-</p>\n<p><html><head></head><body><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-log4j2logconfigurator-java\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-java  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tbody>\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC38\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">@Override</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC39\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"pl-en\">setVerboseMode</span>(<span class=\"pl-k\">boolean</span> <span class=\"pl-v\">verboseMode</span>) {</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC40\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>verboseMode <span class=\"pl-k\">=</span> verboseMode;</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC41\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">if</span> (verboseMode) {</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC42\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-smi\">Layout</span> layout <span class=\"pl-k\">=</span> <span class=\"pl-smi\">PatternLayout</span><span class=\"pl-k\">.</span>newBuilder()<span class=\"pl-k\">.</span>withConfiguration(config)<span class=\"pl-k\">.</span>withPattern(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>[%d{HH:mm:ss.SSS}] [%highlight(%level)] %msg%n<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>build();</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC43\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-smi\">Appender</span> consoleAppender <span class=\"pl-k\">=</span> <span class=\"pl-smi\">ConsoleAppender</span><span class=\"pl-k\">.</span>createDefaultAppenderForLayout(layout);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC44\" class=\"blob-code blob-code-inner js-file-line\">            consoleAppender<span class=\"pl-k\">.</span>start();</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L45\" class=\"blob-num js-line-number\" data-line-number=\"45\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC45\" class=\"blob-code blob-code-inner js-file-line\">            config<span class=\"pl-k\">.</span>getLoggerConfig(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>com.paypal.butterfly.cli<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>removeAppender(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>CONSOLE<span class=\"pl-pds\">&quot;</span></span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L46\" class=\"blob-num js-line-number\" data-line-number=\"46\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC46\" class=\"blob-code blob-code-inner js-file-line\">            config<span class=\"pl-k\">.</span>getRootLogger()<span class=\"pl-k\">.</span>addAppender(consoleAppender,<span class=\"pl-c1\">null</span>,<span class=\"pl-c1\">null</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L47\" class=\"blob-num js-line-number\" data-line-number=\"47\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC47\" class=\"blob-code blob-code-inner js-file-line\">            context<span class=\"pl-k\">.</span>updateLoggers();</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L48\" class=\"blob-num js-line-number\" data-line-number=\"48\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC48\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-c\"><span class=\"pl-c\">//</span>  } else {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L49\" class=\"blob-num js-line-number\" data-line-number=\"49\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC49\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-c\"><span class=\"pl-c\">//</span> TODO</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L50\" class=\"blob-num js-line-number\" data-line-number=\"50\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC50\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfigurator-java-L51\" class=\"blob-num js-line-number\" data-line-number=\"51\"></td>\n        <td id=\"file-log4j2logconfigurator-java-LC51\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n</tbody></table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/Log4j2LogConfigurator.java\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2logconfigurator-java\">Log4j2LogConfigurator.java</a>\n        hosted with &#x2764; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</body></html></p>\n<p>The above method, creates a console appender [line 42-44], removes existing\nappender from root logger[line 46] and attach newly created logger [line 46-47].\nTo understand more about dynamic configuration change, you can read about the\narchitecture of Log4j2 <a href=\"https://logging.apache.org/log4j/2.x/manual/architecture.html\">here</a>.</p>\n<p>At this point, the phase 1 is complete.</p>\n<p><strong>Phase 2: Add Tests</strong></p>\n<p>I need to add test for <code class=\"language-text\">Log4j2LogConfigurator</code> class. There were test cases for\nthe previous configuration <code class=\"language-text\">LogbackLogConfigurator</code>. I re-implemented those\ntests for Log4j2. The following test case is for the method\n<code class=\"language-text\">setVerboseMode(boolean verboseMode)</code> described above.</p>\n<p><html><head></head><body><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-log4j2logconfiguratortest-java\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-java  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tbody>\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC29\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">@Test</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC30\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"pl-en\">testVerboseOnAndRootLoggerHasConsoleAppender</span>(){</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC31\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Configuration</span> config <span class=\"pl-k\">=</span> ((<span class=\"pl-smi\">LoggerContext</span>)<span class=\"pl-smi\">LogManager</span><span class=\"pl-k\">.</span>getContext(<span class=\"pl-c1\">false</span>))<span class=\"pl-k\">.</span>getConfiguration();</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC32\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertNotNull(log4j2VerboseConfigurator);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC33\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertNotNull(log4jLoggerFactory);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC34\" class=\"blob-code blob-code-inner js-file-line\">        log4j2VerboseConfigurator<span class=\"pl-k\">.</span>setVerboseMode(<span class=\"pl-c1\">true</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC35\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">LogManager</span><span class=\"pl-k\">.</span>getLogger(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>com.paypal.butterfly.cli<span class=\"pl-pds\">&quot;</span></span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC36\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertTrue(config<span class=\"pl-k\">.</span>getLoggerConfig(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>com.paypal.butterfly.cli<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>getAppenders()<span class=\"pl-k\">.</span>isEmpty());</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC37\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertTrue(config<span class=\"pl-k\">.</span>getRootLogger()<span class=\"pl-k\">.</span>getAppenders()<span class=\"pl-k\">.</span>get(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>DefaultConsole-2<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>getName()<span class=\"pl-k\">.</span>compareTo(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>DefaultConsole-2<span class=\"pl-pds\">&quot;</span></span>) <span class=\"pl-k\">==</span> <span class=\"pl-c1\">0</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC38\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertTrue(config<span class=\"pl-k\">.</span>getRootLogger()<span class=\"pl-k\">.</span>getAppenders()<span class=\"pl-k\">.</span>get(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Routing<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>getName()<span class=\"pl-k\">.</span>compareTo(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Routing<span class=\"pl-pds\">&quot;</span></span>) <span class=\"pl-k\">==</span> <span class=\"pl-c1\">0</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-log4j2logconfiguratortest-java-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-log4j2logconfiguratortest-java-LC39\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n</tbody></table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/Log4j2LogConfiguratorTest.java\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2logconfiguratortest-java\">Log4j2LogConfiguratorTest.java</a>\n        hosted with &#x2764; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</body></html></p>\n<p>You can see all test cases <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-log4j2logconfiguratortest-java\">here</a>.</p>\n<p>I have also added new test cases to check whether the actual logging is\nhappening as expected. Those test cases are following-</p>\n<p><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-loggertest-java\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-java  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-loggertest-java-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-loggertest-java-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">/**</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-loggertest-java-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"> * Tests for logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-loggertest-java-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"> <span class=\"pl-c\">*/</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-loggertest-java-LC4\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-loggertest-java-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">LoggerTest</span>{</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-loggertest-java-LC6\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-loggertest-java-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">@Test</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-loggertest-java-LC8\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"pl-en\">testLoggingToConsoleWithLevelInfo</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">IOException</span>{</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-loggertest-java-LC9\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">PrintStream</span> originalStdOut<span class=\"pl-k\">=</span> <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>out;</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-loggertest-java-LC10\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">ByteArrayOutputStream</span> consoleContent <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ByteArrayOutputStream</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-loggertest-java-LC11\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">PrintStream</span> printToFile <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PrintStream</span>(consoleContent);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-loggertest-java-LC12\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>setOut(printToFile);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-loggertest-java-LC13\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">LoggerFactory</span><span class=\"pl-k\">.</span>getLogger(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>com.paypal.butterfly.cli<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>info(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Butterfly application transformation tool<span class=\"pl-pds\">&quot;</span></span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-loggertest-java-LC14\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>setOut(originalStdOut);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-loggertest-java-LC15\" class=\"blob-code blob-code-inner js-file-line\">        printToFile<span class=\"pl-k\">.</span>close();</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-loggertest-java-LC16\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertTrue(consoleContent<span class=\"pl-k\">.</span>toString()<span class=\"pl-k\">.</span>compareTo(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Butterfly application transformation tool<span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">==</span><span class=\"pl-c1\">0</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-loggertest-java-LC17\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-loggertest-java-LC18\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-loggertest-java-LC19\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">@Test</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-loggertest-java-LC20\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"pl-en\">testLoggingToFile</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">IOException</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-loggertest-java-LC21\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">String</span> fileName <span class=\"pl-k\">=</span> <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>getProperty(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>user.dir<span class=\"pl-pds\">&quot;</span></span>) <span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>/logs/testLoggingToFile.txt<span class=\"pl-pds\">&quot;</span></span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-loggertest-java-LC22\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">String</span> testLine <span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Butterfly application transformation tool<span class=\"pl-pds\">&quot;</span></span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-loggertest-java-LC23\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>setProperty(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>logFile<span class=\"pl-pds\">&quot;</span></span>,fileName);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-loggertest-java-LC24\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">LoggerFactory</span><span class=\"pl-k\">.</span>getLogger(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>root<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>error(testLine);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-loggertest-java-LC25\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">File</span> logFile <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">File</span>(fileName);</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-loggertest-java-LC26\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertTrue(logFile<span class=\"pl-k\">.</span>exists());</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-loggertest-java-LC27\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>assertTrue(<span class=\"pl-smi\">FileUtils</span><span class=\"pl-k\">.</span>readFileToString(logFile, <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>UTF-8<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>contains(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Butterfly application transformation tool<span class=\"pl-pds\">&quot;</span></span>));</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-loggertest-java-LC28\" class=\"blob-code blob-code-inner js-file-line\">        logFile<span class=\"pl-k\">.</span>delete();</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-loggertest-java-LC29\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n      <tr>\n        <td id=\"file-loggertest-java-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-loggertest-java-LC30\" class=\"blob-code blob-code-inner js-file-line\">}</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/LoggerTest.java\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-loggertest-java\">LoggerTest.java</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n&#x3C;code data-gist-id=“ca176a0335131a092618cb9066fc3fee”</p>\n<p>Now, it is time to run the tests. When I ran the tests one of the tests\nfailed. This was an integration test. The following portion of the test was\nfailing-</p>\n<p><html><head></head><body><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-failingtest-java\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-java  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tbody><tr>\n        <td id=\"file-failingtest-java-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-failingtest-java-LC1\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">@Test</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-failingtest-java-LC2\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> helpTest() throws <span class=\"pl-smi\">IOException</span>, <span class=\"pl-smi\">URISyntaxException</span> {</td>\n      </tr>\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      <tr>\n        <td id=\"file-failingtest-java-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-failingtest-java-LC15\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Capturing the console output</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-failingtest-java-LC16\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">PrintStream</span> systemOut <span class=\"pl-k\">=</span> <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>out;</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-failingtest-java-LC17\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">File</span> helpOut <span class=\"pl-k\">=</span> <span class=\"pl-smi\">File</span><span class=\"pl-k\">.</span>createTempFile(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>butterfly-cli-help-output<span class=\"pl-pds\">&quot;</span></span>, <span class=\"pl-c1\">null</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-failingtest-java-LC18\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">PrintStream</span> helpStream <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PrintStream</span>(helpOut);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-failingtest-java-LC19\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>setOut(helpStream);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-failingtest-java-LC20\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-failingtest-java-LC21\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Running help option three times (in different ways) to capture console output</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-failingtest-java-LC22\" class=\"blob-code blob-code-inner js-file-line\">        assertEquals(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">ButterflyCliApp</span>()<span class=\"pl-k\">.</span>run()<span class=\"pl-k\">.</span>getExitStatus(), <span class=\"pl-c1\">0</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-failingtest-java-LC23\" class=\"blob-code blob-code-inner js-file-line\">        assertEquals(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">ButterflyCliApp</span>()<span class=\"pl-k\">.</span>run(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>-h<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>getExitStatus(), <span class=\"pl-c1\">0</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-failingtest-java-LC24\" class=\"blob-code blob-code-inner js-file-line\">        assertEquals(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">ButterflyCliApp</span>()<span class=\"pl-k\">.</span>run(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>-?<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>getExitStatus(), <span class=\"pl-c1\">0</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-failingtest-java-LC25\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-failingtest-java-LC26\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Closing captured console output stream, and restoring original system out</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-failingtest-java-LC27\" class=\"blob-code blob-code-inner js-file-line\">        helpStream<span class=\"pl-k\">.</span>close();</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-failingtest-java-LC28\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">System</span><span class=\"pl-k\">.</span>setOut(systemOut);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-failingtest-java-LC29\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-failingtest-java-LC30\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Ensuring console output is as expected</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-failingtest-java-LC31\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">File</span> helpBaselineOut <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">File</span>(<span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>getClass()<span class=\"pl-k\">.</span>getResource(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>/helpOut.txt<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>toURI());</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-failingtest-java-LC32\" class=\"blob-code blob-code-inner js-file-line\">        assertTrue(<span class=\"pl-smi\">FileUtils</span><span class=\"pl-k\">.</span>contentEquals(helpBaselineOut, helpOut), <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Generated help differs from test baseline<span class=\"pl-cce\">\\n</span>Test baseline: <span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-k\">+</span> helpBaselineOut <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-cce\">\\n</span>Generated result: <span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-k\">+</span> helpOut <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">&quot;</span></span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-failingtest-java-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-failingtest-java-LC33\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n</tbody></table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/FailingTest.java\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-failingtest-java\">FailingTest.java</a>\n        hosted with &#x2764; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</body></html></p>\n<p>This is where I was stuck for almost 2 days. This test is checking logging to\nconsole by first redirecting printing to console to a file and then matching the\ncontent of that file with base output. It was failing because the log messages\nprinted to console was not redirecting to the file. I could not figure out why.\nI went through the Log4j2 documentation multiple times, checked online. It was\npainful. It took me two days to find the bug and it was a silly bug. I think\nmost of cases, silly bugs are difficult to find. So, the bug was in the\nfollowing line of code in <code class=\"language-text\">log4j2.xml</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-xml line-numbers\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Appenders</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Console</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CONSOLE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SYSTEM_OUT<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  .\n  .\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Appenders</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Log4j2 has a specific attribute for <code class=\"language-text\">ConsoleAppender</code> to allow for redirection\nof <code class=\"language-text\">System.out</code>. It is called <code class=\"language-text\">follow=true</code>. So the fix is following-</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-xml line-numbers\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Appenders</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Console</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CONSOLE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SYSTEM_OUT<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">follow</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  .\n  .\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Appenders</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>As simple as that. I ran the tests again. Alas! it failed again. This time log\nmessages were going to the file but their sequences were messed up. It didn’t\ntake me long to understand that it was due to asynchronous loggers of Log4j2.\nThe test was written for Logback which was logging synchronously. So, obviously\nit is going to fail for asynchronous logging. I did not have much knowledge\nabout testing asynchronous methods. So, I started searching online and reading\ndocumentation for TestNG, the testing framework Butterfly is using. I found that\nusing <code class=\"language-text\">Thread.sleep()</code> is not a good idea to test async code. Moreover, the test\nwas an integration test. I had no idea in how many places, I had to put\n<code class=\"language-text\">Thread.sleep()</code>. I have read in several places, that for testing purpose,\ninstead of async logging configuration, a synchronous logging configuration is\nused. I thought this to be a better solution. Of course, there are other ways\nto test async code, probably better. I need to read about them later. For, now\nI am going to create a separate configuration file for testing purpose.\nEverything in this file is same as <code class=\"language-text\">log4j2.xml</code> except the loggers are not\nasync. So, it looked like below-</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-xml line-numbers\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Loggers</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Logger</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.paypal.butterfly.cli<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">level</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>INFO<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>AppenderRef</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CONSOLE<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Logger</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Root</span> <span class=\"token attr-name\">level</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ERROR<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>AppenderRef</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Routing<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Root</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Loggers</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Run the tests again. This time all tests passed. </p>\n<p><strong>Phase 3: Removing Logback and Test files</strong></p>\n<p>Alright, now that the new framework is fully functioning, it is time to remove\nthe old framework. This basically means removing the configuration files and\ntests related to the framework. The configuration files are again <code class=\"language-text\">logback.xml</code>,\n<code class=\"language-text\">LogFileDefiner.java</code> and <code class=\"language-text\">LogbackLogConfigurator.java</code>. You can look at\nthe pull request <a href=\"https://github.com/paypal/butterfly/pull/367\">here</a> to\nsee all these changes.</p>\n<p>In addition to removing these files, I have to remove the framework from\ndependencies. While removing, we need to remember about the transitive\ndependencies. A portion of Logback was added as direct dependency in the\n<code class=\"language-text\">build.gradle</code> file as below-</p>\n<p><html><head></head><body><div id=\"gist106652245\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-build-gradle\" class=\"file my-2\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-gradle  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tbody><tr>\n        <td id=\"file-build-gradle-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-build-gradle-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-en\">dependencies</span> {</td>\n      </tr>\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      <tr>\n        <td id=\"file-build-gradle-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-build-gradle-LC12\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c1\">logback</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>ch.qos.logback:logback-classic:1.1.7<span class=\"pl-pds\">&quot;</span></span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-build-gradle-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-build-gradle-LC13\" class=\"blob-code blob-code-inner js-file-line\">}</td>\n      </tr>\n</tbody></table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee/raw/11fe25271e5a658a45a6acf4a4beec3f5431de48/build.gradle\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/badalsarkar/ca176a0335131a092618cb9066fc3fee#file-build-gradle\">build.gradle</a>\n        hosted with &#x2764; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</body></html></p>\n<p>So, I removed this. Next to check the transitive dependencies in gradle, I ran\n<code class=\"language-text\">gradle dependencies</code> and found the following-</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7c3620160dfe990c095f8258ec6900b7/302a4/logbackDependency.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 5.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsSAAALEgHS3X78AAAARUlEQVQI1zXFQQ6AIAwEQP//OoFUPQG29KC0fGElJB4ms7kp+iNgzjgvQoj7FJaUIugglJohwmgq0KneBWYvxjC49/XvA16xSMADDpVfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Logback transitive\ndependency\"\n        title=\"Logback transitive\n    dependency\"\n        src=\"/static/7c3620160dfe990c095f8258ec6900b7/f058b/logbackDependency.png\"\n        srcset=\"/static/7c3620160dfe990c095f8258ec6900b7/c26ae/logbackDependency.png 158w,\n/static/7c3620160dfe990c095f8258ec6900b7/6bdcf/logbackDependency.png 315w,\n/static/7c3620160dfe990c095f8258ec6900b7/f058b/logbackDependency.png 630w,\n/static/7c3620160dfe990c095f8258ec6900b7/40601/logbackDependency.png 945w,\n/static/7c3620160dfe990c095f8258ec6900b7/302a4/logbackDependency.png 1080w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>So, Logback-core was brought by Spring framework as transitive dependency. I\nneeded to remove that too like below in the <code class=\"language-text\">build.gradle</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-groovy line-numbers\"><code class=\"language-groovy\">  compile <span class=\"token punctuation\">(</span>lib<span class=\"token punctuation\">.</span>spring_boot_starter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">exclude</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">:</span><span class=\"token string\">'logback-classic'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Alright, now that the old framework and tests files related to it were removed,\nit is time to run the tests again. I ran the tests and all tests passed.\nGreat.</p>\n<h3>Opening PR</h3>\n<p>Before I pushed my code to Github, I double checked my codes to make sure, I am\nnot adding anything unnecessary. Then I rebased my work on the <code class=\"language-text\">develop</code> branch\nand combined all my commits into one single commit and pushed to Github. Finally\nI created a pull request against the <code class=\"language-text\">develop</code> branch. You can see the pull request\n<a href=\"https://github.com/paypal/butterfly/pull/367\">here</a>.</p>\n<h3>My learning</h3>\n<p>This pull request is the biggest one I have done so far. Before I started\nworking on this issue, I knew nothing about logging. I now have fair\nunderstanding of Logback, Log4j2 and SLF4J. I have also used the testing\nframework TestNG. My knowledge about Gradle has also enhanced. Apart from that\nnavigating the code base, understanding how things are working and determining\nwhat to change and how is very critical. Overall, this PR was full of learning\nfor me and I feel good about it.</p>","frontmatter":{"title":"Implementing New Feature in Paypal/Butterfly","date":"November 21, 2020","description":null}},"previous":{"fields":{"slug":"/2020/fixing-telescope-issues/2020-11-21-Fixing-Telescope-Issues/"},"frontmatter":{"title":"Fixing Issue in Telescope"}},"next":{"fields":{"slug":"/2020/butterfly-bug-fix/2020-11-22-butterfly-bug-fixed/"},"frontmatter":{"title":"PayPal/Butterfly Bug Fixed, Finally"}}},"pageContext":{"id":"be590607-bce0-5221-9b21-b41fcfa398ed","previousPostId":"668b1e20-541e-5bee-b3cd-5ac1ec50b62d","nextPostId":"c45217c6-6b02-522b-b862-f168eca93783"}},"staticQueryHashes":["2841359383","916993862"]}